Option Explicit
Public g_objFileSystem As Scripting.FileSystemObject
Public g_objTextStream As Scripting.TextStream

Dim adoConnection As ADODB.Connection
Dim Connectstring As String

Dim sSql As String

Dim X
Dim i
Dim Y
Dim z
Dim MyString As String
Dim Newstring As String
Dim Oneletter
Dim sSourceFile
Dim mClientIp As String
Dim mDhcpName As String
Dim mLease As String
Dim mDhcpType As String
Dim mUniqueId As String
Dim mdhcpdesc As String
Dim mcompname As String

'symantec
Dim gCount9 As Long
Dim gDomainname As String


'ms update
Dim gUpdateWinUpdate As Integer


Dim mType As String
Dim mErrDesc As String

Dim gLaptopDate As String
Dim gLaptopTime As String

Dim gDesktopDate As String
Dim gDesktopTime As String

Dim gAVDate As String
Dim gAVTime As String

Dim gMSDate As String
Dim gMSTime As String
Dim gMSDate2 As String
Dim gMSTime2 As String


Dim gDnsDate As String
Dim gDnsTime As String

Dim gDhcp1Date As String
Dim gDhcp1Time As String

Dim gDhcp11Date As String
Dim gDhcp11Time As String

Dim gDhcp12Date As String
Dim gDhcp12Time As String

Dim gDhcp13Date As String
Dim gDhcp13Time As String

Dim gDhcp15Date As String
Dim gDhcp15Time As String

Dim gDhcp100Date As String
Dim gDhcp100Time As String

Dim gDhcpSvrDate As String
Dim gDhcpSvrTime As String


Dim gDhcpLandDate As String
Dim gDhcpLandTime As String

Dim mBrand As String
Dim mLaptopSerialNo As String


Dim mClient As String
Dim muser As String
Dim mStatus As String
Dim mLastScan As String
Dim mDefinition As String
Dim mVersion As String
Dim mScanEngine As String
Dim mAddress As String
Dim mServer As String

Dim mdata As String
Dim mIpStatus As String
Dim mErrorCode As String
Dim mavIpaddress As String
Dim gLogDateTime As Date
Dim mLogDate As String
Dim mLogTime As String
Dim mInvalidIp As String

Dim xCnXls As String
Dim rs_source As ADODB.Recordset


Dim mFileDateStr As String
Dim mFileTimeStr As String


Dim mspecs As String
Dim mlocation As String
Dim mcc As String
Dim mLastUpdate As String
Dim mloginname As String
    
Dim massetno As String
    
Dim mremarks As String

Dim mprinter As String
Dim marea As String
Dim mprinterrole As String
Dim mprintserial As String
Dim mpdesc As String
Dim mSerialno As String

Public Enum FileMode
    ReadMode = 1
    AppendMode = 2
    WriteMode = 3
End Enum

Private Sub ConvertScanLog1()

    Dim X
    Dim i
    Dim Y
    Dim z
    Dim MyString As String
    Dim Newstring As String
    Dim Oneletter
    Dim sSourceFile
    Dim mstrClient As String
    Dim mstrStatus As String
    Dim mstrLastScan As String
    Dim mstrDefinitions As String
    Dim mstrIPAddress As String
    Dim mstrUser As String
  
    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\scan1.log"

    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.

        If Mid(Trim(MyString), 1, 10) = "Statistics" Then
            
            Exit Do
        End If

        If Mid(Trim(MyString), 1, 9) <> "Microsoft" And MyString <> "" And _
             Mid(Trim(MyString), 1, 9) <> "Copyright" And _
             Mid(Trim(MyString), 1, 10) <> "Statistics" And _
             Mid(MyString, 1, 2) <> "  " Then

                    DoEvents
                    Newstring = Newstring & Oneletter
                
        'append to and_csv_scanlog
        sSql = "insert into and_csv_scanlog(ip_address) values('" & Mid(Trim(MyString), 1, InStr(1, Trim(MyString), ":") - 1) & "')"
        bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                
        Newstring = ""
        i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertScanLog11()

    Dim X
    Dim i
    Dim Y
    Dim z
    Dim MyString As String
    Dim Newstring As String
    Dim Oneletter
    Dim sSourceFile
    Dim mstrClient As String
    Dim mstrStatus As String
    Dim mstrLastScan As String
    Dim mstrDefinitions As String
    Dim mstrIPAddress As String
    Dim mstrUser As String
  
    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\scan11.log"

    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.

        If Mid(Trim(MyString), 1, 10) = "Statistics" Then
            
            Exit Do
        End If

        If Mid(Trim(MyString), 1, 9) <> "Microsoft" And MyString <> "" And _
             Mid(Trim(MyString), 1, 9) <> "Copyright" And _
             Mid(Trim(MyString), 1, 10) <> "Statistics" And _
             Mid(MyString, 1, 2) <> "  " Then

                    DoEvents
                    Newstring = Newstring & Oneletter
                
        'append to and_csv_scanlog
        sSql = "insert into and_csv_scanlog(ip_address) values('" & Mid(Trim(MyString), 1, InStr(1, Trim(MyString), ":") - 1) & "')"
        bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                
        Newstring = ""
        i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertScanLog12()

    Dim X
    Dim i
    Dim Y
    Dim z
    Dim MyString As String
    Dim Newstring As String
    Dim Oneletter
    Dim sSourceFile
    Dim mstrClient As String
    Dim mstrStatus As String
    Dim mstrLastScan As String
    Dim mstrDefinitions As String
    Dim mstrIPAddress As String
    Dim mstrUser As String
  
    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\scan12.log"

    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.

        If Mid(Trim(MyString), 1, 10) = "Statistics" Then
            
            Exit Do
        End If

        If Mid(Trim(MyString), 1, 9) <> "Microsoft" And MyString <> "" And _
             Mid(Trim(MyString), 1, 9) <> "Copyright" And _
             Mid(Trim(MyString), 1, 10) <> "Statistics" And _
             Mid(MyString, 1, 2) <> "  " Then

                    DoEvents
                    Newstring = Newstring & Oneletter
                
        'append to and_csv_scanlog
        sSql = "insert into and_csv_scanlog(ip_address) values('" & Mid(Trim(MyString), 1, InStr(1, Trim(MyString), ":") - 1) & "')"
        bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                
        Newstring = ""
        i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertScanLog13()

    Dim X
    Dim i
    Dim Y
    Dim z
    Dim MyString As String
    Dim Newstring As String
    Dim Oneletter
    Dim sSourceFile
    Dim mstrClient As String
    Dim mstrStatus As String
    Dim mstrLastScan As String
    Dim mstrDefinitions As String
    Dim mstrIPAddress As String
    Dim mstrUser As String
  
    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\scan13.log"

    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.

        If Mid(Trim(MyString), 1, 10) = "Statistics" Then
            
            Exit Do
        End If

        If Mid(Trim(MyString), 1, 9) <> "Microsoft" And MyString <> "" And _
             Mid(Trim(MyString), 1, 9) <> "Copyright" And _
             Mid(Trim(MyString), 1, 10) <> "Statistics" And _
             Mid(MyString, 1, 2) <> "  " Then

                    DoEvents
                    Newstring = Newstring & Oneletter
                
        'append to and_csv_scanlog
        sSql = "insert into and_csv_scanlog(ip_address) values('" & Mid(Trim(MyString), 1, InStr(1, Trim(MyString), ":") - 1) & "')"
        bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                
        Newstring = ""
        i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertScanLog15()

    Dim X
    Dim i
    Dim Y
    Dim z
    Dim MyString As String
    Dim Newstring As String
    Dim Oneletter
    Dim sSourceFile
    Dim mstrClient As String
    Dim mstrStatus As String
    Dim mstrLastScan As String
    Dim mstrDefinitions As String
    Dim mstrIPAddress As String
    Dim mstrUser As String
  
    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\scan15.log"

    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.

        If Mid(Trim(MyString), 1, 10) = "Statistics" Then
            
            Exit Do
        End If

        If Mid(Trim(MyString), 1, 9) <> "Microsoft" And MyString <> "" And _
             Mid(Trim(MyString), 1, 9) <> "Copyright" And _
             Mid(Trim(MyString), 1, 10) <> "Statistics" And _
             Mid(MyString, 1, 2) <> "  " Then

                    DoEvents
                    Newstring = Newstring & Oneletter
                
        'append to and_csv_scanlog
        sSql = "insert into and_csv_scanlog(ip_address) values('" & Mid(Trim(MyString), 1, InStr(1, Trim(MyString), ":") - 1) & "')"
        bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                
        Newstring = ""
        i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertScanLog100()

    Dim X
    Dim i
    Dim Y
    Dim z
    Dim MyString As String
    Dim Newstring As String
    Dim Oneletter
    Dim sSourceFile
    Dim mstrClient As String
    Dim mstrStatus As String
    Dim mstrLastScan As String
    Dim mstrDefinitions As String
    Dim mstrIPAddress As String
    Dim mstrUser As String
  
    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\scan100.log"

    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.

        If Mid(Trim(MyString), 1, 10) = "Statistics" Then
            
            Exit Do
        End If

        If Mid(Trim(MyString), 1, 9) <> "Microsoft" And MyString <> "" And _
             Mid(Trim(MyString), 1, 9) <> "Copyright" And _
             Mid(Trim(MyString), 1, 10) <> "Statistics" And _
             Mid(MyString, 1, 2) <> "  " Then

                    DoEvents
                    Newstring = Newstring & Oneletter
                
        'append to and_csv_scanlog
        sSql = "insert into and_csv_scanlog(ip_address) values('" & Mid(Trim(MyString), 1, InStr(1, Trim(MyString), ":") - 1) & "')"
        bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                
        Newstring = ""
        i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertScanLog148()

    Dim X
    Dim i
    Dim Y
    Dim z
    Dim MyString As String
    Dim Newstring As String
    Dim Oneletter
    Dim sSourceFile
    Dim mstrClient As String
    Dim mstrStatus As String
    Dim mstrLastScan As String
    Dim mstrDefinitions As String
    Dim mstrIPAddress As String
    Dim mstrUser As String
  
    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\scan148.log"

    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.

        If Mid(Trim(MyString), 1, 10) = "Statistics" Then
            
            Exit Do
        End If

        If Mid(Trim(MyString), 1, 9) <> "Microsoft" And MyString <> "" And _
             Mid(Trim(MyString), 1, 9) <> "Copyright" And _
             Mid(Trim(MyString), 1, 10) <> "Statistics" And _
             Mid(MyString, 1, 2) <> "  " Then

                    DoEvents
                    Newstring = Newstring & Oneletter
                
        'append to and_csv_scanlog
        sSql = "insert into and_csv_scanlog(ip_address) values('" & Mid(Trim(MyString), 1, InStr(1, Trim(MyString), ":") - 1) & "')"
        bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                
        Newstring = ""
        i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertAdComputerCSV()

    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\adcomputer.csv"
        
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Name" And Trim(MyString) <> "Type" And Trim(MyString) <> "Description" _
                And Trim(MyString) <> "" Then

            i = i + 1
            
            For X = 1 To Len(MyString)
                Oneletter = Mid(MyString, X, 1)

                DoEvents
                Newstring = Newstring & Oneletter
        
            Next X
                    
            If MyString = "" Then
                Newstring = " "
            End If
            
            Select Case i
                Case 1
                    mClient = Newstring
                Case 2
                    
                    i = 0
                    mType = Newstring
                    
                    'append to and_csv_dcadcomputer
                    sSql = "insert into and_csv_dcadcomputer(computer_name,source,type) values('" & Trim(mClient) & "','AD','" & _
                                mType & "')"
                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                    
            End Select
            
            Newstring = ""
                                
        'Newstring = ""
        'i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.


End Sub

Private Sub ConvertDcComputerCsv()

    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\dccomputer.csv"
    
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Name" And Trim(MyString) <> "Type" And Trim(MyString) <> "Description" _
                And Trim(MyString) <> "" Then

            i = i + 1
            
            For X = 1 To Len(MyString)
                Oneletter = Mid(MyString, X, 1)

                DoEvents
                Newstring = Newstring & Oneletter
        
            Next X
                    
            If MyString = "" Then
                Newstring = " "
            End If
            
            Select Case i
                Case 1
                    mClient = Newstring
                Case 2
                    
                    i = 0
                    mType = Newstring
                    
                    'check if existing in and_csv_dcadcomputer
                    sSql = "Select computer_name from and_csv_dcadcomputer where computer_name = '" & Trim(mClient) & "'"
                    If DataAccess.GetRecordset(sConnectSQL, sSql, oRs) Then
                        If oRs.RecordCount > 0 Then
                            'update
                            sSql = "update and_csv_dcadcomputer set source = 'DC', type = '" & mType & "' where computer_name = '" & Trim(mClient) & "'"
                            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        Else
                            'append to and_csv_dcadcomputer
                            sSql = "insert into and_csv_dcadcomputer(computer_name,source,type) values('" & Trim(mClient) & "','DC','" & _
                                        mType & "')"
                            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                        End If
                    End If
                    oRs.Close
                    
            End Select
            
            Newstring = ""
                                
        'Newstring = ""
        'i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.


End Sub

Private Sub ConvertIpPhoneCsv()

    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\ipphone.csv"
    
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Name" And Trim(MyString) <> "Type" And Trim(MyString) <> "Description" _
                And Trim(MyString) <> "" And Mid(Trim(MyString), 1, 11) <> "CGN Printer" _
                And Mid(Trim(MyString), 1, 6) <> "Dammam" Then

            i = i + 1
            
            For X = 1 To Len(MyString)
                Oneletter = Mid(MyString, X, 1)

                DoEvents
                Newstring = Newstring & Oneletter
        
            Next X
                    
            If MyString = "" Then
                Newstring = " "
            End If
            
            Select Case i
                Case 1
                    mClient = Newstring
                    
                Case 2
                    
                    i = 0
                    mType = Newstring
                    
                    
                    'check if existing in and_csv_dcadcomputer
                    sSql = "Select computer_name from and_csv_dcadcomputer where computer_name = '" & Trim(mClient) & "'"
                    If DataAccess.GetRecordset(sConnectSQL, sSql, oRs) Then
                        If oRs.RecordCount > 0 Then
                            'update
                            sSql = "update and_csv_dcadcomputer set source = 'IP', type = '" & mType & "' where computer_name = '" & Trim(mClient) & "'"
                            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        Else
                            'append to and_csv_dcadcomputer
                            sSql = "insert into and_csv_dcadcomputer(computer_name,source,type) values('" & Trim(mClient) & "','IP','" & _
                                        mType & "')"
                            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        End If
                    End If
                    oRs.Close
                    
                    
            End Select
            
            Newstring = ""
                                
        'Newstring = ""
        'i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertDnsCsv()

    Dim sFileName As String
    Dim sFromFile As String
    Dim aFields As Variant
    
   
    sFileName = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\dns.csv"
    
    'get date and time
    gDnsDate = Format(FileDateTime(sFileName), "dd mmm yyyy")
    gDnsTime = Format(FileDateTime(sFileName), "hh:mm")
    
    
    Set g_objFileSystem = New Scripting.FileSystemObject
    If Not OpenTextFileR(sFileName) Then
        MsgBox "Cannot open the file : " + sFileName, vbCritical + vbOKOnly
        Exit Sub
    End If
    
        
    Do While Not g_objTextStream.AtEndOfStream ' Loop until End of file.
        sFromFile = g_objTextStream.ReadLine
        aFields = Split(sFromFile, ",")
    


        If aFields(0) <> "Name" And UBound(aFields) < 3 Then

            mcompname = UCase(aFields(0))
            mType = aFields(1)
            mdata = aFields(2)

                'append to and_csv_dcadcomputer
            sSql = "insert into and_csv_dns(computer_name,dns_type,dns_data) values('" & mcompname & "','" & _
                        mType & "','" & mdata & "')"
            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
    
            DoEvents ' it is important To unlock the screen
        End If
        
    Loop

    Set g_objFileSystem = Nothing


End Sub

Private Sub ConvertDHCPCsvOne()

    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\dhcp1.csv"
    
    'get date and time
    gDhcp1Date = Format(FileDateTime(sSourceFile), "dd mmm yyyy")
    gDhcp1Time = Format(FileDateTime(sSourceFile), "hh:mm")
    
    
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Client IP Address" And Trim(MyString) <> "Name" And Trim(MyString) <> "Lease Expiration" _
                And Trim(MyString) <> "Type" And Trim(MyString) <> "Unique ID" _
                And Trim(MyString) <> "Description" Then

            i = i + 1
            
            For X = 1 To Len(MyString)
                Oneletter = Mid(MyString, X, 1)

                DoEvents
                Newstring = Newstring & Oneletter
        
            Next X
                    
            If MyString = "" Then
                Newstring = " "
            End If
            
            
            Select Case i
                Case 1
                    mClientIp = Newstring
                Case 2
                    mDhcpName = Newstring
                    If InStr(1, Trim(mDhcpName), ".") > 0 Then
                        mcompname = UCase(Mid(Trim(mDhcpName), 1, InStr(1, Trim(mDhcpName), ".") - 1))
                    Else
                        mcompname = UCase(mDhcpName)
                    End If
                    
                    If InStr(1, UCase(Trim(mDhcpName)), "SAUDI-ERICSSON") = 0 Then
                        mIpStatus = "Invalid Domain"
                    Else
                        mIpStatus = " "
                    End If
                
                Case 3
                    mLease = Newstring
                    If InStr(1, Trim(mLease), "inactive") > 0 Then
                        mIpStatus = "Inactive"
                    End If
                Case 4
                    mDhcpType = Newstring
                Case 5
                    mUniqueId = Newstring
                Case 6
                    mdhcpdesc = Newstring
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
        
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
                    
                    i = 0
                        'append to and_csv_dhcp
                         sSql = "insert into and_csv_dhcp(client_ipaddress,computer_name,dhcp_name,lease_expiration," & _
                                "type,unique_id,dhcp_description,dhcp_source,err_desc) values('" & mClientIp & "','" & _
                                mcompname & "','" & mDhcpName & "','" & mLease & "','" & mDhcpType & "','" & _
                                mUniqueId & "','" & mdhcpdesc & "','1','" & mIpStatus & "')"
                         bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
            End Select
            Newstring = ""

                                
                                
                                
        'Newstring = ""
        'i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertDHCPCsvEleven()

    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\dhcp11.csv"
    
    'get date and time
    gDhcp11Date = Format(FileDateTime(sSourceFile), "dd mmm yyyy")
    gDhcp11Time = Format(FileDateTime(sSourceFile), "hh:mm")
    
    
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Client IP Address" And Trim(MyString) <> "Name" And Trim(MyString) <> "Lease Expiration" _
                And Trim(MyString) <> "Type" And Trim(MyString) <> "Unique ID" _
                And Trim(MyString) <> "Description" Then

            i = i + 1
            
            For X = 1 To Len(MyString)
                Oneletter = Mid(MyString, X, 1)

                DoEvents
                Newstring = Newstring & Oneletter
        
            Next X
                    
            If MyString = "" Then
                Newstring = " "
            End If
            
            Select Case i
                Case 1
                    mClientIp = Newstring
                Case 2
                    mDhcpName = Newstring
                    If InStr(1, Trim(mDhcpName), ".") > 0 Then
                        mcompname = UCase(Mid(Trim(mDhcpName), 1, InStr(1, Trim(mDhcpName), ".") - 1))
                    Else
                        mcompname = UCase(mDhcpName)
                    End If
                    
                    If InStr(1, UCase(Trim(mDhcpName)), "SAUDI-ERICSSON") = 0 Then
                        mIpStatus = "Invalid Domain"
                    Else
                        mIpStatus = " "
                    End If
                
                Case 3
                    mLease = Newstring
                    If InStr(1, Trim(mLease), "inactive") > 0 Then
                        mIpStatus = "Inactive"
                    End If
                Case 4
                    mDhcpType = Newstring
                Case 5
                    mUniqueId = Newstring
                Case 6
                    mdhcpdesc = Newstring
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
        
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
                    
                    i = 0
                        'append to and_csv_dhcp
                         sSql = "insert into and_csv_dhcp(client_ipaddress,computer_name,dhcp_name,lease_expiration," & _
                                "type,unique_id,dhcp_description,dhcp_source,err_desc) values('" & mClientIp & "','" & _
                                mcompname & "','" & mDhcpName & "','" & mLease & "','" & mDhcpType & "','" & _
                                mUniqueId & "','" & mdhcpdesc & "','11','" & mIpStatus & "')"
                         bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
            End Select
            Newstring = ""

                                
                                
                                
        'Newstring = ""
        'i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertDHCPCsvTwelve()

    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\dhcp12.csv"
    
    'get date and time
    gDhcp12Date = Format(FileDateTime(sSourceFile), "dd mmm yyyy")
    gDhcp12Time = Format(FileDateTime(sSourceFile), "hh:mm")
    
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Client IP Address" And Trim(MyString) <> "Name" And Trim(MyString) <> "Lease Expiration" _
                And Trim(MyString) <> "Type" And Trim(MyString) <> "Unique ID" _
                And Trim(MyString) <> "Description" Then

            i = i + 1
            
            For X = 1 To Len(MyString)
                Oneletter = Mid(MyString, X, 1)

                DoEvents
                Newstring = Newstring & Oneletter
        
            Next X
                    
            If MyString = "" Then
                Newstring = " "
            End If
            
            Select Case i
                Case 1
                    mClientIp = Newstring
                Case 2
                    mDhcpName = Newstring
                    If InStr(1, Trim(mDhcpName), ".") > 0 Then
                        mcompname = UCase(Mid(Trim(mDhcpName), 1, InStr(1, Trim(mDhcpName), ".") - 1))
                    Else
                        mcompname = UCase(mDhcpName)
                    End If
                    
                    If InStr(1, UCase(Trim(mDhcpName)), "SAUDI-ERICSSON") = 0 Then
                        mIpStatus = "Invalid Domain"
                    Else
                        mIpStatus = " "
                    End If
                
                Case 3
                    mLease = Newstring
                    If InStr(1, Trim(mLease), "inactive") > 0 Then
                        mIpStatus = "Inactive"
                    End If
                Case 4
                    mDhcpType = Newstring
                Case 5
                    mUniqueId = Newstring
                Case 6
                    mdhcpdesc = Newstring
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
        
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
                    
                    i = 0
                        'append to and_csv_dhcp
                         sSql = "insert into and_csv_dhcp(client_ipaddress,computer_name,dhcp_name,lease_expiration," & _
                                "type,unique_id,dhcp_description,dhcp_source,err_desc) values('" & mClientIp & "','" & _
                                mcompname & "','" & mDhcpName & "','" & mLease & "','" & mDhcpType & "','" & _
                                mUniqueId & "','" & mdhcpdesc & "','12','" & mIpStatus & "')"
                         bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
            End Select
            Newstring = ""
                                
                                
        'Newstring = ""
        'i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertDHCPCsvThirteen()

    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\dhcp13.csv"
    
    'get date and time
    gDhcp13Date = Format(FileDateTime(sSourceFile), "dd mmm yyyy")
    gDhcp13Time = Format(FileDateTime(sSourceFile), "hh:mm")
    
    
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Client IP Address" And Trim(MyString) <> "Name" And Trim(MyString) <> "Lease Expiration" _
                And Trim(MyString) <> "Type" And Trim(MyString) <> "Unique ID" _
                And Trim(MyString) <> "Description" Then

            i = i + 1
            
            For X = 1 To Len(MyString)
                Oneletter = Mid(MyString, X, 1)

                DoEvents
                Newstring = Newstring & Oneletter
        
            Next X
                    
            If MyString = "" Then
                Newstring = " "
            End If
            
            Select Case i
                Case 1
                    mClientIp = Newstring
                Case 2
                    mDhcpName = Newstring
                    If InStr(1, Trim(mDhcpName), ".") > 0 Then
                        mcompname = UCase(Mid(Trim(mDhcpName), 1, InStr(1, Trim(mDhcpName), ".") - 1))
                    Else
                        mcompname = UCase(mDhcpName)
                    End If
                    
                    If InStr(1, UCase(Trim(mDhcpName)), "SAUDI-ERICSSON") = 0 Then
                        mIpStatus = "Invalid Domain"
                    Else
                        mIpStatus = " "
                    End If
                
                Case 3
                    mLease = Newstring
                    If InStr(1, Trim(mLease), "inactive") > 0 Then
                        mIpStatus = "Inactive"
                    End If
                Case 4
                    mDhcpType = Newstring
                Case 5
                    mUniqueId = Newstring
                Case 6
                    mdhcpdesc = Newstring
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
        
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
                    
                    i = 0
                        'append to and_csv_dhcp
                         sSql = "insert into and_csv_dhcp(client_ipaddress,computer_name,dhcp_name,lease_expiration," & _
                                "type,unique_id,dhcp_description,dhcp_source,err_desc) values('" & mClientIp & "','" & _
                                mcompname & "','" & mDhcpName & "','" & mLease & "','" & mDhcpType & "','" & _
                                mUniqueId & "','" & mdhcpdesc & "','13','" & mIpStatus & "')"
                         bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
            End Select
            Newstring = ""

                                
                                
                                
        'Newstring = ""
        'i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertDHCPCsvSvr()

    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\dhcpsvr.csv"
    
    'get date and time
    gDhcpSvrDate = Format(FileDateTime(sSourceFile), "dd mmm yyyy")
    gDhcpSvrTime = Format(FileDateTime(sSourceFile), "hh:mm")
    
    
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Client IP Address" And Trim(MyString) <> "Name" And Trim(MyString) <> "Lease Expiration" _
                And Trim(MyString) <> "Type" And Trim(MyString) <> "Unique ID" _
                And Trim(MyString) <> "Description" Then

            i = i + 1
            
            For X = 1 To Len(MyString)
                Oneletter = Mid(MyString, X, 1)

                DoEvents
                Newstring = Newstring & Oneletter
        
            Next X
                    
            If MyString = "" Then
                Newstring = " "
            End If
            
            Select Case i
                Case 1
                    mClientIp = Newstring
                Case 2
                    mDhcpName = Newstring
                    If InStr(1, Trim(mDhcpName), ".") > 0 Then
                        mcompname = UCase(Mid(Trim(mDhcpName), 1, InStr(1, Trim(mDhcpName), ".") - 1))
                    Else
                        mcompname = UCase(mDhcpName)
                    End If
                    
                    If InStr(1, UCase(Trim(mDhcpName)), "SAUDI-ERICSSON") = 0 Then
                        mIpStatus = "Invalid Domain"
                    Else
                        mIpStatus = " "
                    End If
                
                Case 3
                    mLease = Newstring
                    If InStr(1, Trim(mLease), "inactive") > 0 Then
                        mIpStatus = "Inactive"
                    End If
                Case 4
                    mDhcpType = Newstring
                Case 5
                    mUniqueId = Newstring
                Case 6
                    mdhcpdesc = Newstring
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
        
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
                    
                    i = 0
                        'append to and_csv_dhcp
                         sSql = "insert into and_csv_dhcp(client_ipaddress,computer_name,dhcp_name,lease_expiration," & _
                                "type,unique_id,dhcp_description,dhcp_source,err_desc) values('" & mClientIp & "','" & _
                                mcompname & "','" & mDhcpName & "','" & mLease & "','" & mDhcpType & "','" & _
                                mUniqueId & "','" & mdhcpdesc & "','svr','" & mIpStatus & "')"
                         bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
            End Select
            Newstring = ""

                                
        'Newstring = ""
        'i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.


End Sub

Private Sub ConvertDHCPCsvSixteen()

    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\dhcp16.csv"
    
    'get date and time
    gDhcp15Date = Format(FileDateTime(sSourceFile), "dd mmm yyyy")
    gDhcp15Time = Format(FileDateTime(sSourceFile), "hh:mm")
    
    
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Client IP Address" And Trim(MyString) <> "Name" And Trim(MyString) <> "Lease Expiration" _
                And Trim(MyString) <> "Type" And Trim(MyString) <> "Unique ID" _
                And Trim(MyString) <> "Description" Then

            i = i + 1
            
            For X = 1 To Len(MyString)
                Oneletter = Mid(MyString, X, 1)

                DoEvents
                Newstring = Newstring & Oneletter
        
            Next X
                    
            If MyString = "" Then
                Newstring = " "
            End If
            
            Select Case i
                Case 1
                    mClientIp = Newstring
                Case 2
                    mDhcpName = Newstring
                    If InStr(1, Trim(mDhcpName), ".") > 0 Then
                        mcompname = UCase(Mid(Trim(mDhcpName), 1, InStr(1, Trim(mDhcpName), ".") - 1))
                    Else
                        mcompname = UCase(mDhcpName)
                    End If
                    
                    If InStr(1, UCase(Trim(mDhcpName)), "SAUDI-ERICSSON") = 0 Then
                        mIpStatus = "Invalid Domain"
                    Else
                        mIpStatus = " "
                    End If
                
                Case 3
                    mLease = Newstring
                    If InStr(1, Trim(mLease), "inactive") > 0 Then
                        mIpStatus = "Inactive"
                    End If
                Case 4
                    mDhcpType = Newstring
                Case 5
                    mUniqueId = Newstring
                Case 6
                    mdhcpdesc = Newstring
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
        
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
                    
                    i = 0
                        'append to and_csv_dhcp
                         sSql = "insert into and_csv_dhcp(client_ipaddress,computer_name,dhcp_name,lease_expiration," & _
                                "type,unique_id,dhcp_description,dhcp_source,err_desc) values('" & mClientIp & "','" & _
                                mcompname & "','" & mDhcpName & "','" & mLease & "','" & mDhcpType & "','" & _
                                mUniqueId & "','" & mdhcpdesc & "','16','" & mIpStatus & "')"
                         bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
            End Select
            Newstring = ""

                                
        'Newstring = ""
        'i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.


End Sub

Private Sub ConvertDHCPCsvFifteen()

    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\dhcp15.csv"
    
    'get date and time
    gDhcp15Date = Format(FileDateTime(sSourceFile), "dd mmm yyyy")
    gDhcp15Time = Format(FileDateTime(sSourceFile), "hh:mm")
    
    
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Client IP Address" And Trim(MyString) <> "Name" And Trim(MyString) <> "Lease Expiration" _
                And Trim(MyString) <> "Type" And Trim(MyString) <> "Unique ID" _
                And Trim(MyString) <> "Description" Then

            i = i + 1
            
            For X = 1 To Len(MyString)
                Oneletter = Mid(MyString, X, 1)

                DoEvents
                Newstring = Newstring & Oneletter
        
            Next X
                    
            If MyString = "" Then
                Newstring = " "
            End If
            
            Select Case i
                Case 1
                    mClientIp = Newstring
                Case 2
                    mDhcpName = Newstring
                    If InStr(1, Trim(mDhcpName), ".") > 0 Then
                        mcompname = UCase(Mid(Trim(mDhcpName), 1, InStr(1, Trim(mDhcpName), ".") - 1))
                    Else
                        mcompname = UCase(mDhcpName)
                    End If
                    
                    If InStr(1, UCase(Trim(mDhcpName)), "SAUDI-ERICSSON") = 0 Then
                        mIpStatus = "Invalid Domain"
                    Else
                        mIpStatus = " "
                    End If
                
                Case 3
                    mLease = Newstring
                    If InStr(1, Trim(mLease), "inactive") > 0 Then
                        mIpStatus = "Inactive"
                    End If
                Case 4
                    mDhcpType = Newstring
                Case 5
                    mUniqueId = Newstring
                Case 6
                    mdhcpdesc = Newstring
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
        
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
                    
                    i = 0
                        'append to and_csv_dhcp
                         sSql = "insert into and_csv_dhcp(client_ipaddress,computer_name,dhcp_name,lease_expiration," & _
                                "type,unique_id,dhcp_description,dhcp_source,err_desc) values('" & mClientIp & "','" & _
                                mcompname & "','" & mDhcpName & "','" & mLease & "','" & mDhcpType & "','" & _
                                mUniqueId & "','" & mdhcpdesc & "','15','" & mIpStatus & "')"
                         bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
            End Select
            Newstring = ""

                                
                                
                                
        'Newstring = ""
        'i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertDHCPCsvOneHundred()

    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\dhcp100.csv"
    
    'get date and time
    gDhcp100Date = Format(FileDateTime(sSourceFile), "dd mmm yyyy")
    gDhcp100Time = Format(FileDateTime(sSourceFile), "hh:mm")
    
    
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Client IP Address" And Trim(MyString) <> "Name" And Trim(MyString) <> "Lease Expiration" _
                And Trim(MyString) <> "Type" And Trim(MyString) <> "Unique ID" _
                And Trim(MyString) <> "Description" Then

            i = i + 1
            
            For X = 1 To Len(MyString)
                Oneletter = Mid(MyString, X, 1)

                DoEvents
                Newstring = Newstring & Oneletter
        
            Next X
                    
            If MyString = "" Then
                Newstring = " "
            End If
            
            Select Case i
                Case 1
                    mClientIp = Newstring
                Case 2
                    mDhcpName = Newstring
                    If InStr(1, Trim(mDhcpName), ".") > 0 Then
                        mcompname = UCase(Mid(Trim(mDhcpName), 1, InStr(1, Trim(mDhcpName), ".") - 1))
                    Else
                        mcompname = UCase(mDhcpName)
                    End If
                    
                    If InStr(1, UCase(Trim(mDhcpName)), "SAUDI-ERICSSON") = 0 Then
                        mIpStatus = "Invalid Domain"
                    Else
                        mIpStatus = " "
                    End If
                
                Case 3
                    mLease = Newstring
                    If InStr(1, Trim(mLease), "inactive") > 0 Then
                        mIpStatus = "Inactive"
                    End If
                Case 4
                    mDhcpType = Newstring
                Case 5
                    mUniqueId = Newstring
                Case 6
                    mdhcpdesc = Newstring
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
        
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
                    
                    i = 0
                        'append to and_csv_dhcp
                         sSql = "insert into and_csv_dhcp(client_ipaddress,computer_name,dhcp_name,lease_expiration," & _
                                "type,unique_id,dhcp_description,dhcp_source,err_desc) values('" & mClientIp & "','" & _
                                mcompname & "','" & mDhcpName & "','" & mLease & "','" & mDhcpType & "','" & _
                                mUniqueId & "','" & mdhcpdesc & "','100','" & mIpStatus & "')"
                         bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
            End Select
            Newstring = ""

                                
        'Newstring = ""
        'i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertDHCPCsvLandDevice()

    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\landevice.csv"
    
    'get date and time
    gDhcpLandDate = Format(FileDateTime(sSourceFile), "dd mmm yyyy")
    gDhcpLandTime = Format(FileDateTime(sSourceFile), "hh:mm")
    
    
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Client IP Address" And Trim(MyString) <> "Name" And Trim(MyString) <> "Lease Expiration" _
                And Trim(MyString) <> "Type" And Trim(MyString) <> "Unique ID" _
                And Trim(MyString) <> "Description" Then

            i = i + 1
            
            For X = 1 To Len(MyString)
                Oneletter = Mid(MyString, X, 1)

                DoEvents
                Newstring = Newstring & Oneletter
        
            Next X
                    
            If MyString = "" Then
                Newstring = " "
            End If
            
            Select Case i
                Case 1
                    mClientIp = Newstring
                Case 2
                    mDhcpName = Newstring
                    If InStr(1, Trim(mDhcpName), ".") > 0 Then
                        mcompname = UCase(Mid(Trim(mDhcpName), 1, InStr(1, Trim(mDhcpName), ".") - 1))
                    Else
                        mcompname = UCase(mDhcpName)
                    End If
                    
                    If InStr(1, UCase(Trim(mDhcpName)), "SAUDI-ERICSSON") = 0 Then
                        mIpStatus = "Invalid Domain"
                    Else
                        mIpStatus = " "
                    End If
                
                Case 3
                    mLease = Newstring
                    If InStr(1, Trim(mLease), "inactive") > 0 Then
                        mIpStatus = "Inactive"
                    End If
                Case 4
                    mDhcpType = Newstring
                Case 5
                    mUniqueId = Newstring
                Case 6
                    mdhcpdesc = Newstring
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
        
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
                    
                    i = 0
                        'append to and_csv_dhcp
                         sSql = "insert into and_csv_dhcp(client_ipaddress,computer_name,dhcp_name,lease_expiration," & _
                                "type,unique_id,dhcp_description,dhcp_source,err_desc) values('" & mClientIp & "','" & _
                                mcompname & "','" & mDhcpName & "','" & mLease & "','" & mDhcpType & "','" & _
                                mUniqueId & "','" & mdhcpdesc & "','land','" & mIpStatus & "')"
                         bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
            End Select
            Newstring = ""

                                
        'Newstring = ""
        'i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertTextFile1()
  
    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\adcomputer.csv"
    
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Name" And Trim(MyString) <> "Type" And Trim(MyString) <> "Description" _
                And Trim(MyString) <> "" And Trim(MyString) <> "Computer" Then

                
                    DoEvents
                    Newstring = Newstring & Oneletter
            
                
                
        'append to and_csv_dcadcomputer
        sSql = "insert into and_csv_dcadcomputer(computer_name,source) values('" & Trim(MyString) & "','AD')"
        bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                
                                
        Newstring = ""
        i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertTextFile2()

    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\dccomputer.csv"
    
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Name" And Trim(MyString) <> "Type" And Trim(MyString) <> "Description" _
                And Trim(MyString) <> "" And Trim(MyString) <> "Computer" And Trim(MyString) <> "DC Server" _
                And Trim(MyString) <> "Server" And Trim(MyString) <> "Router" And Trim(MyString) <> "PABX" _
                And Trim(MyString) <> "Wireless" And Trim(MyString) <> "Switch" Then
                
                    DoEvents
                    Newstring = Newstring & Oneletter
            
        'append to and_csv_dcadcomputer
        sSql = "insert into and_csv_dcadcomputer(computer_name,source) values('" & Trim(MyString) & "','DC')"
        bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                
                                
        Newstring = ""
        i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertTextFile2_A()

    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\ipphone.csv"
    
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Name" And Trim(MyString) <> "Type" And Trim(MyString) <> "Description" _
                And Trim(MyString) <> "" And Trim(MyString) <> "Computer" And _
                Trim(MyString) <> "IPPhone" And Trim(MyString) <> "Printer" And Trim(MyString) <> "PrintSir" Then
                
                    DoEvents
                    Newstring = Newstring & Oneletter
            
        'append to and_csv_dcadcomputer
        sSql = "insert into and_csv_dcadcomputer(computer_name,source) values('" & Trim(MyString) & "','IP')"
        bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                
                                
        Newstring = ""
        i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertLandDevice()

    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\landevice.csv"
    
        Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Client IP Address" And Trim(MyString) <> "Name" And Trim(MyString) <> "Lease Expiration" _
                And Trim(MyString) <> "Type" And Trim(MyString) <> "Unique ID" And Trim(MyString) <> "Unique ID" _
                And Trim(MyString) <> "Description" Then

            i = i + 1
            
            For X = 1 To Len(MyString)
                Oneletter = Mid(MyString, X, 1)

                DoEvents
                Newstring = Newstring & Oneletter
        
            Next X
                    
            If MyString = "" Then
                Newstring = " "
            End If
            
            Select Case i
                Case 1
                    mClientIp = Newstring
                Case 2
                    mDhcpName = Newstring
                    If InStr(1, Trim(mDhcpName), ".") > 0 Then
                        mcompname = UCase(Mid(Trim(mDhcpName), 1, InStr(1, Trim(mDhcpName), ".") - 1))
                    Else
                        mcompname = UCase(mDhcpName)
                    End If
                    If InStr(1, UCase(Trim(mDhcpName)), "SAUDI-ERICSSON") = 0 Then
                        mIpStatus = "Invalid Domain"
                        mErrorCode = "1001"
                    Else
                        mIpStatus = " "
                        mErrorCode = " "
                    End If
                Case 3
                    mLease = Newstring
                    If InStr(1, Trim(mLease), "inactive") > 0 Then
                        mIpStatus = "Inactive"
                        mErrorCode = "1002"
                    End If
                Case 4
                    mDhcpType = Newstring
                Case 5
                    mUniqueId = Newstring
                Case 6
                    mdhcpdesc = Newstring
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
        
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
                    
                    i = 0
                        'append to and_csv_dhcp
                         sSql = "insert into and_csv_dhcp(client_ipaddress,computer_name,dhcp_name,lease_expiration," & _
                                "type,unique_id,dhcp_description,dhcp_source,ip_status,error_code) values('" & mClientIp & "','" & _
                                mcompname & "','" & mDhcpName & "','" & mLease & "','" & mDhcpType & "','" & _
                                mUniqueId & "','" & mdhcpdesc & "','land','" & mIpStatus & "','" & mErrorCode & "')"
                         bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                         
                'append to and_csv_dcadcomputer
                sSql = "insert into and_csv_dcadcomputer(computer_name,source) values('" & Trim(mcompname) & "','LD')"
                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                         
                         
            If mErrorCode <> " " Then
                    If Mid(mdhcpdesc, 1, 7) <> "Reserve" Then
                            If mErrorCode = "1001" Then
                                sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
                                     "values('" & mLogDate & "','" & mLogTime & "','dhcp','" & mcompname & "','1001','Invalid Domain')"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            Else
                                sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
                                     "values('" & mLogDate & "','" & mLogTime & "','dhcp','" & mcompname & "','1002','Inactive')"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            End If
                    End If
            End If
                        
            End Select
            Newstring = ""

                                
        'Newstring = ""
        'i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertTextFile3()

    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\dhcp1.csv"
    
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Client IP Address" And Trim(MyString) <> "Name" And Trim(MyString) <> "Lease Expiration" _
                And Trim(MyString) <> "Type" And Trim(MyString) <> "Unique ID" And Trim(MyString) <> "Unique ID" _
                And Trim(MyString) <> "Description" Then

            i = i + 1
            
            For X = 1 To Len(MyString)
                Oneletter = Mid(MyString, X, 1)

                DoEvents
                Newstring = Newstring & Oneletter
        
            Next X
                    
            If MyString = "" Then
                Newstring = " "
            End If
            
            Select Case i
                Case 1
                    mClientIp = Newstring
                Case 2
                    mDhcpName = Newstring
                    If InStr(1, Trim(mDhcpName), ".") > 0 Then
                        mcompname = UCase(Mid(Trim(mDhcpName), 1, InStr(1, Trim(mDhcpName), ".") - 1))
                    Else
                        mcompname = UCase(mDhcpName)
                    End If
                    If InStr(1, UCase(Trim(mDhcpName)), "SAUDI-ERICSSON") = 0 Then
                        mIpStatus = "Invalid Domain"
                        mErrorCode = "1001"
                    Else
                        mIpStatus = " "
                        mErrorCode = " "
                    End If
                Case 3
                    mLease = Newstring
                    If InStr(1, Trim(mLease), "inactive") > 0 Then
                        mIpStatus = "Inactive"
                        mErrorCode = "1002"
                    End If
                Case 4
                    mDhcpType = Newstring
                Case 5
                    mUniqueId = Newstring
                Case 6
                    mdhcpdesc = Newstring
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
        
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
                    
                    i = 0
                        'append to and_csv_dhcp
                         sSql = "insert into and_csv_dhcp(client_ipaddress,computer_name,dhcp_name,lease_expiration," & _
                                "type,unique_id,dhcp_description,dhcp_source,ip_status,error_code) values('" & mClientIp & "','" & _
                                mcompname & "','" & mDhcpName & "','" & mLease & "','" & mDhcpType & "','" & _
                                mUniqueId & "','" & mdhcpdesc & "','1','" & mIpStatus & "','" & mErrorCode & "')"
                         bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                         
                         If mErrorCode <> " " Then
                            If Mid(mdhcpdesc, 1, 7) <> "Reserve" Then
                                If mErrorCode = "1001" Then
                                    sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
                                     "values('" & mLogDate & "','" & mLogTime & "','dhcp','" & mcompname & "','1001','Invalid Domain')"
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                Else
                                    sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
                                     "values('" & mLogDate & "','" & mLogTime & "','dhcp','" & mcompname & "','1002','Inactive')"
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                End If
                            End If
                        End If
            End Select
            Newstring = ""
                                
                                
                                
        'Newstring = ""
        'i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertTextFile4()

    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\dhcp12.csv"
    
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Client IP Address" And Trim(MyString) <> "Name" And Trim(MyString) <> "Lease Expiration" _
                And Trim(MyString) <> "Type" And Trim(MyString) <> "Unique ID" And Trim(MyString) <> "Unique ID" _
                And Trim(MyString) <> "Description" Then

            i = i + 1
            
            For X = 1 To Len(MyString)
                Oneletter = Mid(MyString, X, 1)

                DoEvents
                Newstring = Newstring & Oneletter
        
            Next X
                    
            If MyString = "" Then
                Newstring = " "
            End If
            
            Select Case i
                Case 1
                    mClientIp = Newstring
                Case 2
                    mDhcpName = Newstring
                    If InStr(1, Trim(mDhcpName), ".") > 0 Then
                        mcompname = UCase(Mid(Trim(mDhcpName), 1, InStr(1, Trim(mDhcpName), ".") - 1))
                    Else
                        mcompname = UCase(mDhcpName)
                    End If
                    If InStr(1, UCase(Trim(mDhcpName)), "SAUDI-ERICSSON") = 0 Then
                        mIpStatus = "Invalid Domain"
                        mErrorCode = "1001"
                    Else
                        mIpStatus = " "
                        mErrorCode = " "
                    End If
                Case 3
                    mLease = Newstring
                    If InStr(1, Trim(mLease), "inactive") > 0 Then
                        mIpStatus = "Inactive"
                        mErrorCode = "1002"
                    End If
                Case 4
                    mDhcpType = Newstring
                Case 5
                    mUniqueId = Newstring
                Case 6
                    mdhcpdesc = Newstring
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
        
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
                    
                    i = 0
                        'append to and_csv_dhcp
                         sSql = "insert into and_csv_dhcp(client_ipaddress,computer_name,dhcp_name,lease_expiration," & _
                                "type,unique_id,dhcp_description,dhcp_source,ip_status,error_code) values('" & mClientIp & "','" & _
                                mcompname & "','" & mDhcpName & "','" & mLease & "','" & mDhcpType & "','" & _
                                mUniqueId & "','" & mdhcpdesc & "','12','" & mIpStatus & "','" & mErrorCode & "')"
                         bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                         
                    If mErrorCode <> " " Then
                        If Mid(mdhcpdesc, 1, 7) <> "Reserve" Then
                            If mErrorCode = "1001" Then
                                sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
                                     "values('" & mLogDate & "','" & mLogTime & "','dhcp','" & mcompname & "','1001','Invalid Domain')"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            Else
                                sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
                                     "values('" & mLogDate & "','" & mLogTime & "','dhcp','" & mcompname & "','1002','Inactive')"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            End If
                        End If
                    End If
                        
            End Select
            Newstring = ""

                                
                                
                                
        'Newstring = ""
        'i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertTextFile5()

    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\dhcp13.csv"
    
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Client IP Address" And Trim(MyString) <> "Name" And Trim(MyString) <> "Lease Expiration" _
                And Trim(MyString) <> "Type" And Trim(MyString) <> "Unique ID" And Trim(MyString) <> "Unique ID" _
                And Trim(MyString) <> "Description" Then

            i = i + 1
            
            For X = 1 To Len(MyString)
                Oneletter = Mid(MyString, X, 1)

                DoEvents
                Newstring = Newstring & Oneletter
        
            Next X
                    
            If MyString = "" Then
                Newstring = " "
            End If
            
            Select Case i
                Case 1
                    mClientIp = Newstring
                Case 2
                    mDhcpName = Newstring
                    If InStr(1, Trim(mDhcpName), ".") > 0 Then
                        mcompname = UCase(Mid(Trim(mDhcpName), 1, InStr(1, Trim(mDhcpName), ".") - 1))
                    Else
                        mcompname = UCase(mDhcpName)
                    End If
                    If InStr(1, UCase(Trim(mDhcpName)), "SAUDI-ERICSSON") = 0 Then
                        mIpStatus = "Invalid Domain"
                        mErrorCode = "1001"
                    Else
                        mIpStatus = " "
                        mErrorCode = " "
                    End If
                Case 3
                    mLease = Newstring
                    If InStr(1, Trim(mLease), "inactive") > 0 Then
                        mIpStatus = "Inactive"
                        mErrorCode = "1002"
                    End If
                Case 4
                    mDhcpType = Newstring
                Case 5
                    mUniqueId = Newstring
                Case 6
                    mdhcpdesc = Newstring
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
        
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
                    
                    i = 0
                        'append to and_csv_dhcp
                         sSql = "insert into and_csv_dhcp(client_ipaddress,computer_name,dhcp_name,lease_expiration," & _
                                "type,unique_id,dhcp_description,dhcp_source,ip_status,error_code) values('" & mClientIp & "','" & _
                                mcompname & "','" & mDhcpName & "','" & mLease & "','" & mDhcpType & "','" & _
                                mUniqueId & "','" & mdhcpdesc & "','13','" & mIpStatus & "','" & mErrorCode & "')"
                         bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                         
                    If mErrorCode <> " " Then
                        If Mid(mdhcpdesc, 1, 7) <> "Reserve" Then
                            If mErrorCode = "1001" Then
                                sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
                                     "values('" & mLogDate & "','" & mLogTime & "','dhcp','" & mcompname & "','1001','Invalid Domain')"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            Else
                                sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
                                     "values('" & mLogDate & "','" & mLogTime & "','dhcp','" & mcompname & "','1002','Inactive')"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            End If
                        End If
                    End If
                        
            End Select
            Newstring = ""

                                
                                
                                
        'Newstring = ""
        'i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertTextFile5_b()

    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\dhcp16.csv"
    
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Client IP Address" And Trim(MyString) <> "Name" And Trim(MyString) <> "Lease Expiration" _
                And Trim(MyString) <> "Type" And Trim(MyString) <> "Unique ID" And Trim(MyString) <> "Unique ID" _
                And Trim(MyString) <> "Description" Then

            i = i + 1
            
            For X = 1 To Len(MyString)
                Oneletter = Mid(MyString, X, 1)

                DoEvents
                Newstring = Newstring & Oneletter
        
            Next X
                    
            If MyString = "" Then
                Newstring = " "
            End If
            
            Select Case i
                Case 1
                    mClientIp = Newstring
                Case 2
                    mDhcpName = Newstring
                    If InStr(1, Trim(mDhcpName), ".") > 0 Then
                        mcompname = UCase(Mid(Trim(mDhcpName), 1, InStr(1, Trim(mDhcpName), ".") - 1))
                    Else
                        mcompname = UCase(mDhcpName)
                    End If
                    If InStr(1, UCase(Trim(mDhcpName)), "SAUDI-ERICSSON") = 0 Then
                        mIpStatus = "Invalid Domain"
                        mErrorCode = "1001"
                    Else
                        mIpStatus = " "
                        mErrorCode = " "
                    End If
                Case 3
                    mLease = Newstring
                    If InStr(1, Trim(mLease), "inactive") > 0 Then
                        mIpStatus = "Inactive"
                        mErrorCode = "1002"
                    End If
                Case 4
                    mDhcpType = Newstring
                Case 5
                    mUniqueId = Newstring
                Case 6
                    mdhcpdesc = Newstring
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
        
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
                    
                    i = 0
                        'append to and_csv_dhcp
                         sSql = "insert into and_csv_dhcp(client_ipaddress,computer_name,dhcp_name,lease_expiration," & _
                                "type,unique_id,dhcp_description,dhcp_source,ip_status,error_code) values('" & mClientIp & "','" & _
                                mcompname & "','" & mDhcpName & "','" & mLease & "','" & mDhcpType & "','" & _
                                mUniqueId & "','" & mdhcpdesc & "','15','" & mIpStatus & "','" & mErrorCode & "')"
                         bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                         
                    If mErrorCode <> " " Then
                        If Mid(mdhcpdesc, 1, 7) <> "Reserve" Then
                            If mErrorCode = "1001" Then
                                sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
                                     "values('" & mLogDate & "','" & mLogTime & "','dhcp','" & mcompname & "','1001','Invalid Domain')"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            Else
                                sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
                                     "values('" & mLogDate & "','" & mLogTime & "','dhcp','" & mcompname & "','1002','Inactive')"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            End If
                        End If
                    End If
                        
            End Select
            Newstring = ""

                                
                                
                                
        'Newstring = ""
        'i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertTextFile5_a()

    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\dhcp15.csv"
    
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Client IP Address" And Trim(MyString) <> "Name" And Trim(MyString) <> "Lease Expiration" _
                And Trim(MyString) <> "Type" And Trim(MyString) <> "Unique ID" And Trim(MyString) <> "Unique ID" _
                And Trim(MyString) <> "Description" Then

            i = i + 1
            
            For X = 1 To Len(MyString)
                Oneletter = Mid(MyString, X, 1)

                DoEvents
                Newstring = Newstring & Oneletter
        
            Next X
                    
            If MyString = "" Then
                Newstring = " "
            End If
            
            Select Case i
                Case 1
                    mClientIp = Newstring
                Case 2
                    mDhcpName = Newstring
                    If InStr(1, Trim(mDhcpName), ".") > 0 Then
                        mcompname = UCase(Mid(Trim(mDhcpName), 1, InStr(1, Trim(mDhcpName), ".") - 1))
                    Else
                        mcompname = UCase(mDhcpName)
                    End If
                    If InStr(1, UCase(Trim(mDhcpName)), "SAUDI-ERICSSON") = 0 Then
                        mIpStatus = "Invalid Domain"
                        mErrorCode = "1001"
                    Else
                        mIpStatus = " "
                        mErrorCode = " "
                    End If
                Case 3
                    mLease = Newstring
                    If InStr(1, Trim(mLease), "inactive") > 0 Then
                        mIpStatus = "Inactive"
                        mErrorCode = "1002"
                    End If
                Case 4
                    mDhcpType = Newstring
                Case 5
                    mUniqueId = Newstring
                Case 6
                    mdhcpdesc = Newstring
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
        
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
                    
                    i = 0
                        'append to and_csv_dhcp
                         sSql = "insert into and_csv_dhcp(client_ipaddress,computer_name,dhcp_name,lease_expiration," & _
                                "type,unique_id,dhcp_description,dhcp_source,ip_status,error_code) values('" & mClientIp & "','" & _
                                mcompname & "','" & mDhcpName & "','" & mLease & "','" & mDhcpType & "','" & _
                                mUniqueId & "','" & mdhcpdesc & "','15','" & mIpStatus & "','" & mErrorCode & "')"
                         bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                         
                    If mErrorCode <> " " Then
                        If Mid(mdhcpdesc, 1, 7) <> "Reserve" Then
                            If mErrorCode = "1001" Then
                                sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
                                     "values('" & mLogDate & "','" & mLogTime & "','dhcp','" & mcompname & "','1001','Invalid Domain')"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            Else
                                sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
                                     "values('" & mLogDate & "','" & mLogTime & "','dhcp','" & mcompname & "','1002','Inactive')"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            End If
                        End If
                    End If
                        
            End Select
            Newstring = ""

                                
                                
                                
        'Newstring = ""
        'i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertTextFile6()

    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\dhcp100.csv"
    
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Client IP Address" And Trim(MyString) <> "Name" And Trim(MyString) <> "Lease Expiration" _
                And Trim(MyString) <> "Type" And Trim(MyString) <> "Unique ID" And Trim(MyString) <> "Unique ID" _
                And Trim(MyString) <> "Description" Then

            i = i + 1
            
            For X = 1 To Len(MyString)
                Oneletter = Mid(MyString, X, 1)

                DoEvents
                Newstring = Newstring & Oneletter
        
            Next X
                    
            If MyString = "" Then
                Newstring = " "
            End If
            
            Select Case i
                Case 1
                    mClientIp = Newstring
                Case 2
                    mDhcpName = Newstring
                    If InStr(1, Trim(mDhcpName), ".") > 0 Then
                        mcompname = UCase(Mid(Trim(mDhcpName), 1, InStr(1, Trim(mDhcpName), ".") - 1))
                    Else
                        mcompname = UCase(mDhcpName)
                    End If
                    If InStr(1, UCase(Trim(mDhcpName)), "SAUDI-ERICSSON") = 0 Then
                        mIpStatus = "Invalid Domain"
                        mErrorCode = "1001"
                    Else
                        mIpStatus = " "
                        mErrorCode = " "
                    End If
                Case 3
                    mLease = Newstring
                    If InStr(1, Trim(mLease), "inactive") > 0 Then
                        mIpStatus = "Inactive"
                        mErrorCode = "1002"
                    End If
                Case 4
                    mDhcpType = Newstring
                Case 5
                    mUniqueId = Newstring
                Case 6
                    mdhcpdesc = Newstring
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
        
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
                    
                    i = 0
                        'append to and_csv_dhcp
                         sSql = "insert into and_csv_dhcp(client_ipaddress,computer_name,dhcp_name,lease_expiration," & _
                                "type,unique_id,dhcp_description,dhcp_source,ip_status,error_code) values('" & mClientIp & "','" & _
                                mcompname & "','" & mDhcpName & "','" & mLease & "','" & mDhcpType & "','" & _
                                mUniqueId & "','" & mdhcpdesc & "','100','" & mIpStatus & "','" & mErrorCode & "')"
                         bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                         
                If mErrorCode <> " " Then
                    If Mid(mdhcpdesc, 1, 7) <> "Reserve" Then
                            If mErrorCode = "1001" Then
                                sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
                                     "values('" & mLogDate & "','" & mLogTime & "','dhcp','" & mcompname & "','1001','Invalid Domain')"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            Else
                                sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
                                     "values('" & mLogDate & "','" & mLogTime & "','dhcp','" & mcompname & "','1002','Inactive')"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            End If
                    End If
                End If
                        
            End Select
            Newstring = ""

                                
                                
                                
        'Newstring = ""
        'i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertTextFile7()

    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\dhcp148.csv"
    
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Client IP Address" And Trim(MyString) <> "Name" And Trim(MyString) <> "Lease Expiration" _
                And Trim(MyString) <> "Type" And Trim(MyString) <> "Unique ID" And Trim(MyString) <> "Unique ID" _
                And Trim(MyString) <> "Description" Then

            i = i + 1
            
            For X = 1 To Len(MyString)
                Oneletter = Mid(MyString, X, 1)

                DoEvents
                Newstring = Newstring & Oneletter
        
            Next X
                    
            If MyString = "" Then
                Newstring = " "
            End If
            
            Select Case i
                Case 1
                    mClientIp = Newstring
                Case 2
                    mDhcpName = Newstring
                    If InStr(1, Trim(mDhcpName), ".") > 0 Then
                        mcompname = UCase(Mid(Trim(mDhcpName), 1, InStr(1, Trim(mDhcpName), ".") - 1))
                    Else
                        mcompname = UCase(mDhcpName)
                    End If
                    If InStr(1, UCase(Trim(mDhcpName)), "SAUDI-ERICSSON") = 0 Then
                        mIpStatus = "Invalid Domain"
                        mErrorCode = "1001"
                    Else
                        mIpStatus = " "
                        mErrorCode = " "
                    End If
                Case 3
                    mLease = Newstring
                    If InStr(1, Trim(mLease), "inactive") > 0 Then
                        mIpStatus = "Inactive"
                        mErrorCode = "1002"
                    End If
                Case 4
                    mDhcpType = Newstring
                Case 5
                    mUniqueId = Newstring
                Case 6
                    mdhcpdesc = Newstring
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
        
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
                    
                    i = 0
                        'append to and_csv_dhcp
                         sSql = "insert into and_csv_dhcp(client_ipaddress,computer_name,dhcp_name,lease_expiration," & _
                                "type,unique_id,dhcp_description,dhcp_source,ip_status,error_code) values('" & mClientIp & "','" & _
                                mcompname & "','" & mDhcpName & "','" & mLease & "','" & mDhcpType & "','" & _
                                mUniqueId & "','" & mdhcpdesc & "','148','" & mIpStatus & "','" & mErrorCode & "')"
                         bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                         
                If mErrorCode <> " " Then
                    If Mid(mdhcpdesc, 1, 7) <> "Reserve" Then
                            If mErrorCode = "1001" Then
                                sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
                                     "values('" & mLogDate & "','" & mLogTime & "','dhcp','" & mcompname & "','1001','Invalid Domain')"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            Else
                                sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
                                     "values('" & mLogDate & "','" & mLogTime & "','dhcp','" & mcompname & "','1002','Inactive')"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            End If
                    End If
                End If
                        
            End Select
            Newstring = ""

                                
        'Newstring = ""
        'i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertTextFile7_a()

    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\dhcpsvr.csv"
    
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Client IP Address" And Trim(MyString) <> "Name" And Trim(MyString) <> "Lease Expiration" _
                And Trim(MyString) <> "Type" And Trim(MyString) <> "Unique ID" And Trim(MyString) <> "Unique ID" _
                And Trim(MyString) <> "Description" Then

            i = i + 1
            
            For X = 1 To Len(MyString)
                Oneletter = Mid(MyString, X, 1)

                DoEvents
                Newstring = Newstring & Oneletter
        
            Next X
                    
            If MyString = "" Then
                Newstring = " "
            End If
            
            Select Case i
                Case 1
                    mClientIp = Newstring
                Case 2
                    mDhcpName = Newstring
                    If InStr(1, Trim(mDhcpName), ".") > 0 Then
                        mcompname = UCase(Mid(Trim(mDhcpName), 1, InStr(1, Trim(mDhcpName), ".") - 1))
                    Else
                        mcompname = UCase(mDhcpName)
                    End If
                    If InStr(1, UCase(Trim(mDhcpName)), "SAUDI-ERICSSON") = 0 Then
                        mIpStatus = "Invalid Domain"
                        mErrorCode = "1001"
                    Else
                        mIpStatus = " "
                        mErrorCode = " "
                    End If
                Case 3
                    mLease = Newstring
                    If InStr(1, Trim(mLease), "inactive") > 0 Then
                        mIpStatus = "Inactive"
                        mErrorCode = "1002"
                    End If
                Case 4
                    mDhcpType = Newstring
                Case 5
                    mUniqueId = Newstring
                Case 6
                    mdhcpdesc = Newstring
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
        
                    If InStr(1, Trim(mdhcpdesc), "'") > 0 Then
                        mdhcpdesc = Mid(Trim(mdhcpdesc), 1, InStr(1, Trim(mdhcpdesc), "'") - 1) & _
                        Mid(Trim(mdhcpdesc), InStr(1, Trim(mdhcpdesc), "'") + 1, Len(Trim(mdhcpdesc)) - InStr(1, Trim(mdhcpdesc), "'"))
                    End If
                    
                    i = 0
                        'append to and_csv_dhcp
                         sSql = "insert into and_csv_dhcp(client_ipaddress,computer_name,dhcp_name,lease_expiration," & _
                                "type,unique_id,dhcp_description,dhcp_source,ip_status,error_code) values('" & mClientIp & "','" & _
                                mcompname & "','" & mDhcpName & "','" & mLease & "','" & mDhcpType & "','" & _
                                mUniqueId & "','" & mdhcpdesc & "','svr','" & mIpStatus & "','" & mErrorCode & "')"
                         bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                         
            If mErrorCode <> " " Then
                    If Mid(mdhcpdesc, 1, 7) <> "Reserve" Then
                            If mErrorCode = "1001" Then
                                sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
                                     "values('" & mLogDate & "','" & mLogTime & "','dhcp','" & mcompname & "','1001','Invalid Domain')"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            Else
                                sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
                                     "values('" & mLogDate & "','" & mLogTime & "','dhcp','" & mcompname & "','1002','Inactive')"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            End If
                    End If
            End If
                        
            End Select
            Newstring = ""

                                
        'Newstring = ""
        'i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub NewConvertExcelIE8Vista()

Dim sFileName As String
Dim xstatus As String

sFileName = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\IE8Vista.xls"

    'get date and time
    gLaptopDate = Format(FileDateTime(sFileName), "dd mmm yyyy")
    gLaptopTime = Format(FileDateTime(sFileName), "hh:mm")

mcompname = " "

Set adoConnection = New ADODB.Connection

Connectstring = "Provider=SQLOLEDB.1;Persist Security Info=False;" & _
   "User ID=scheme;Pwd=Er1c550n2;Initial Catalog=SES;Data Source=SESLSVRHO"

adoConnection.Open Connectstring

xCnXls = "Provider=MSDASQL.1;Extended Properties=DBQ=\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\IE8Vista.xls;Driver={Microsoft Excel Driver (*.xls)};DriverId=790;MaxBufferSize=2048;PageTimeout=5;"

    Dim sourcetble As String
    
    'build query string for excel data
    sourcetble = " SELECT * FROM [Sheet2$]"
    
Set rs_source = OpenRSXLS(sourcetble)
    If rs_source.RecordCount <> 0 Then
        Do While Not rs_source.EOF
            DoEvents

          If Not IsNull(rs_source.Fields.Item(3)) Then
          
                If Not IsNull(rs_source.Fields.Item(3)) Then
                    mcompname = rs_source.Fields.Item(3)
                Else
                    mcompname = " "
                End If
               
                If Not IsNull(rs_source.Fields.Item(5)) Then
                    xstatus = rs_source.Fields.Item(5)
                Else
                    xstatus = " "
                End If

          End If
        
                If InStr(1, Trim(mcompname), ".") > 0 Then
                        mcompname = Mid(Trim(mcompname), 1, InStr(1, Trim(mcompname), ".") - 1)
                End If
        
        If Trim(mcompname) <> "" Then
            If Trim(mcompname) <> "Computer Detailed Status Report" And Trim(mcompname) <> "Computer Name" Then
                sSql = "insert into and_csv_ie8(computer_name,source,status) " & _
                        "values('" & UCase(Trim(mcompname)) & "','Vista','" & xstatus & "')"
                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
            End If
        End If
        
        mcompname = " "
        
        rs_source.MoveNext
        
        Loop
    End If

'delete blank computer name
sSql = "delete from and_csv_ie8 where ltrim(computer_name) = '' OR ltrim(status) = ''"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)


End Sub

Private Sub NewConvertExcelIE82003()

Dim sFileName As String
Dim xstatus As String

sFileName = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\IE8Win2003.xls"

    'get date and time
    gLaptopDate = Format(FileDateTime(sFileName), "dd mmm yyyy")
    gLaptopTime = Format(FileDateTime(sFileName), "hh:mm")

mcompname = " "

Set adoConnection = New ADODB.Connection

Connectstring = "Provider=SQLOLEDB.1;Persist Security Info=False;" & _
   "User ID=scheme;Pwd=Er1c550n2;Initial Catalog=SES;Data Source=SESLSVRHO"

adoConnection.Open Connectstring

xCnXls = "Provider=MSDASQL.1;Extended Properties=DBQ=\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\IE8Win2003.xls;Driver={Microsoft Excel Driver (*.xls)};DriverId=790;MaxBufferSize=2048;PageTimeout=5;"

    Dim sourcetble As String
    
    'build query string for excel data
    sourcetble = " SELECT * FROM [Sheet2$]"
    
Set rs_source = OpenRSXLS(sourcetble)
    If rs_source.RecordCount <> 0 Then
        Do While Not rs_source.EOF
            DoEvents

          If Not IsNull(rs_source.Fields.Item(3)) Then
          
                If Not IsNull(rs_source.Fields.Item(3)) Then
                    mcompname = rs_source.Fields.Item(3)
                Else
                    mcompname = " "
                End If
               
                If Not IsNull(rs_source.Fields.Item(5)) Then
                    xstatus = rs_source.Fields.Item(5)
                Else
                    xstatus = " "
                End If

          End If
        
                If InStr(1, Trim(mcompname), ".") > 0 Then
                        mcompname = Mid(Trim(mcompname), 1, InStr(1, Trim(mcompname), ".") - 1)
                End If
        
        If Trim(mcompname) <> "" Then
            If Trim(mcompname) <> "Computer Detailed Status Report" And Trim(mcompname) <> "Computer Name" Then
                sSql = "insert into and_csv_ie8(computer_name,source,status) " & _
                        "values('" & UCase(Trim(mcompname)) & "','2003','" & xstatus & "')"
                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
            End If
        End If
        
        mcompname = " "
        
        rs_source.MoveNext
        
        Loop
    End If

'delete blank computer name
sSql = "delete from and_csv_ie8 where ltrim(computer_name) = '' OR ltrim(status) = ''"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)


End Sub

Private Sub NewConvertExcelNoIE8_1()

Dim sFileName As String
Dim xstatus As String

sFileName = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\NoIE8-1.xls"

    'get date and time
    gLaptopDate = Format(FileDateTime(sFileName), "dd mmm yyyy")
    gLaptopTime = Format(FileDateTime(sFileName), "hh:mm")

mcompname = " "

Set adoConnection = New ADODB.Connection

Connectstring = "Provider=SQLOLEDB.1;Persist Security Info=False;" & _
   "User ID=scheme;Pwd=Er1c550n2;Initial Catalog=SES;Data Source=SESLSVRHO"

adoConnection.Open Connectstring

xCnXls = "Provider=MSDASQL.1;Extended Properties=DBQ=\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\NoIE8-1.xls;Driver={Microsoft Excel Driver (*.xls)};DriverId=790;MaxBufferSize=2048;PageTimeout=5;"

    Dim sourcetble As String
    
    'build query string for excel data
    sourcetble = " SELECT * FROM [Sheet2$]"
    
Set rs_source = OpenRSXLS(sourcetble)
    If rs_source.RecordCount <> 0 Then
        Do While Not rs_source.EOF
            DoEvents

          If Not IsNull(rs_source.Fields.Item(3)) Then
          
                If Not IsNull(rs_source.Fields.Item(3)) Then
                    mcompname = rs_source.Fields.Item(3)
                Else
                    mcompname = " "
                End If
               
                If Not IsNull(rs_source.Fields.Item(5)) Then
                    xstatus = rs_source.Fields.Item(5)
                Else
                    xstatus = " "
                End If

          End If
        
                If InStr(1, Trim(mcompname), ".") > 0 Then
                        mcompname = Mid(Trim(mcompname), 1, InStr(1, Trim(mcompname), ".") - 1)
                End If
        
        If Trim(mcompname) <> "" Then
            If Trim(mcompname) <> "Computer Detailed Status Report" And Trim(mcompname) <> "Computer Name" Then
                sSql = "insert into and_csv_ie8(computer_name,source,status) " & _
                        "values('" & UCase(Trim(mcompname)) & "','1','" & xstatus & "')"
                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
            End If
        End If
        
        mcompname = " "
        
        rs_source.MoveNext
        
        Loop
    End If

'delete blank computer name
sSql = "delete from and_csv_ie8 where ltrim(computer_name) = '' OR ltrim(status) = ''"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

End Sub

Private Sub NewConvertExcelNoIE8_2()

Dim sFileName As String
Dim xstatus As String

sFileName = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\NoIE8-2.xls"

    'get date and time
    gLaptopDate = Format(FileDateTime(sFileName), "dd mmm yyyy")
    gLaptopTime = Format(FileDateTime(sFileName), "hh:mm")

mcompname = " "

Set adoConnection = New ADODB.Connection

Connectstring = "Provider=SQLOLEDB.1;Persist Security Info=False;" & _
   "User ID=scheme;Pwd=Er1c550n2;Initial Catalog=SES;Data Source=SESLSVRHO"

adoConnection.Open Connectstring

xCnXls = "Provider=MSDASQL.1;Extended Properties=DBQ=\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\NoIE8-2.xls;Driver={Microsoft Excel Driver (*.xls)};DriverId=790;MaxBufferSize=2048;PageTimeout=5;"

    Dim sourcetble As String
    
    'build query string for excel data
    sourcetble = " SELECT * FROM [Sheet2$]"
    
Set rs_source = OpenRSXLS(sourcetble)
    If rs_source.RecordCount <> 0 Then
        Do While Not rs_source.EOF
            DoEvents

          If Not IsNull(rs_source.Fields.Item(3)) Then
          
                If Not IsNull(rs_source.Fields.Item(3)) Then
                    mcompname = rs_source.Fields.Item(3)
                Else
                    mcompname = " "
                End If
               
                If Not IsNull(rs_source.Fields.Item(5)) Then
                    xstatus = rs_source.Fields.Item(5)
                Else
                    xstatus = " "
                End If

          End If
        
                If InStr(1, Trim(mcompname), ".") > 0 Then
                        mcompname = Mid(Trim(mcompname), 1, InStr(1, Trim(mcompname), ".") - 1)
                End If
        
        If Trim(mcompname) <> "" Then
            If Trim(mcompname) <> "Computer Detailed Status Report" And Trim(mcompname) <> "Computer Name" Then
                sSql = "insert into and_csv_ie8(computer_name,source,status) " & _
                        "values('" & UCase(Trim(mcompname)) & "','2','" & xstatus & "')"
                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
            End If
        End If
        
        mcompname = " "
        
        rs_source.MoveNext
        
        Loop
    End If

'delete blank computer name
sSql = "delete from and_csv_ie8 where ltrim(computer_name) = '' OR ltrim(status) = ''"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

End Sub

Private Sub NewConvertExcelIE8XP()

Dim sFileName As String
Dim xstatus As String

sFileName = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\IE8WinXP.xls"

    'get date and time
    gLaptopDate = Format(FileDateTime(sFileName), "dd mmm yyyy")
    gLaptopTime = Format(FileDateTime(sFileName), "hh:mm")

mcompname = " "

Set adoConnection = New ADODB.Connection

Connectstring = "Provider=SQLOLEDB.1;Persist Security Info=False;" & _
   "User ID=scheme;Pwd=Er1c550n2;Initial Catalog=SES;Data Source=SESLSVRHO"

adoConnection.Open Connectstring

xCnXls = "Provider=MSDASQL.1;Extended Properties=DBQ=\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\IE8WinXP.xls;Driver={Microsoft Excel Driver (*.xls)};DriverId=790;MaxBufferSize=2048;PageTimeout=5;"

    Dim sourcetble As String
    
    'build query string for excel data
    sourcetble = " SELECT * FROM [Sheet2$]"
    
Set rs_source = OpenRSXLS(sourcetble)
    If rs_source.RecordCount <> 0 Then
        Do While Not rs_source.EOF
            DoEvents

          If Not IsNull(rs_source.Fields.Item(3)) Then
          
                If Not IsNull(rs_source.Fields.Item(3)) Then
                    mcompname = rs_source.Fields.Item(3)
                Else
                    mcompname = " "
                End If
               
                If Not IsNull(rs_source.Fields.Item(5)) Then
                    xstatus = rs_source.Fields.Item(5)
                Else
                    xstatus = " "
                End If

          End If
        
                If InStr(1, Trim(mcompname), ".") > 0 Then
                        mcompname = Mid(Trim(mcompname), 1, InStr(1, Trim(mcompname), ".") - 1)
                End If
        
        If Trim(mcompname) <> "" Then
            If Trim(mcompname) <> "Computer Detailed Status Report" And Trim(mcompname) <> "Computer Name" Then
                sSql = "insert into and_csv_ie8(computer_name,source,status) " & _
                        "values('" & UCase(Trim(mcompname)) & "','XP','" & xstatus & "')"
                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
            End If
        End If
        
        mcompname = " "
        
        rs_source.MoveNext
        
        Loop
    End If

'delete blank computer name
sSql = "delete from and_csv_ie8 where ltrim(computer_name) = '' OR ltrim(status) = ''"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

End Sub

Private Sub NewConvertExcelAntiVirusFile()

Set adoConnection = New ADODB.Connection

Connectstring = "Provider=SQLOLEDB.1;Persist Security Info=False;" & _
   "User ID=scheme;Pwd=Er1c550n2;Initial Catalog=Ericsson;Data Source=SESLSVRHO"

adoConnection.Open Connectstring

xCnXls = "Provider=MSDASQL.1;Extended Properties=DBQ=\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\sav.xls;Driver={Microsoft Excel Driver (*.xls)};DriverId=790;MaxBufferSize=2048;PageTimeout=5;"

    Dim sourcetble As String
    
    'build query string for excel data
    sourcetble = " SELECT * FROM [sav$]"
    
Set rs_source = OpenRSXLS(sourcetble)
    If rs_source.RecordCount <> 0 Then
        Do While Not rs_source.EOF
            DoEvents

          If Not IsNull(rs_source.Fields.Item(0)) Then
                If Not IsNull(rs_source.Fields.Item(44)) Then
                    mcompname = rs_source.Fields.Item(44)
                Else
                    mcompname = " "
                End If
                
                
                If Not IsNull(rs_source.Fields.Item(83)) Then
                    muser = Trim(rs_source.Fields.Item(83))
                Else
                    muser = " "
                End If
                
                
                    'muser = Newstring
                    'If InStr(1, UCase(Trim(muser)), "SAUDI-ERICSSON") = 0 Then
                    '    mIpStatus = "Invalid Domain"
                    '    mErrorCode = "1001"
                    'Else
                    '    mIpStatus = " "
                    '    mErrorCode = " "
                    'End If
                
                If Not IsNull(rs_source.Fields.Item(45)) Then
                    mpdesc = rs_source.Fields.Item(45)
                    If UCase(Trim(mpdesc)) <> "SAUDI-ERICSSON.COM" Then
                        mIpStatus = "Invalid Domain"
                        mErrorCode = "1001"
                    Else
                        mIpStatus = " "
                        mErrorCode = " "
                    End If
                Else
                    mpdesc = " "
                End If
                

                    'mStatus = Newstring
                    'mLastScan = Newstring
                    'mDefinition = Newstring
                    'mVersion = Newstring
                    'mScanEngine = Newstring
                    'mAddress = Newstring
                    'mavIpaddress = Mid(Newstring, 6, 20)
                    'mServer = Newstring
                
                If Not IsNull(rs_source.Fields.Item(19)) Then
                    mStatus = rs_source.Fields.Item(19)
                Else
                    mStatus = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(35)) Then
                    mLastScan = rs_source.Fields.Item(35)
                Else
                    mLastScan = " "
                End If
               
                'If Not IsNull(rs_source.Fields.Item(4)) Then
                '    mDefinition = rs_source.Fields.Item(4)
                'Else
                    mDefinition = " "
                'End If
               
                If Not IsNull(rs_source.Fields.Item(3)) Then
                    mVersion = rs_source.Fields.Item(3)
                Else
                    mVersion = " "
                End If
               
               
                If Not IsNull(rs_source.Fields.Item(38)) Then
                    mScanEngine = rs_source.Fields.Item(38)
                Else
                    mScanEngine = " "
                End If
               
                
                If Not IsNull(rs_source.Fields.Item(58)) Then
                    mavIpaddress = rs_source.Fields.Item(58)
                Else
                    mavIpaddress = " "
                End If
               
                If Not IsNull(rs_source.Fields.Item(80)) Then
                    mServer = rs_source.Fields.Item(80)
                Else
                    mServer = " "
                End If

         End If
        
        If Trim(mcompname) <> "" Then

                'append to and_csv_
                sSql = "insert into and_csv_av(computer_name,avuser,avstatus,avlastscan," & _
                        "avdefinition,avversion,avscanengine,avaddress,avserver,avbranch,avipaddress,ip_status,error_code) values('" & UCase(mcompname) & "','" & _
                        muser & "','" & mStatus & "','" & mLastScan & "','" & mDefinition & "','" & _
                        mVersion & "','" & mScanEngine & "','" & mavIpaddress & "','" & mServer & "',' ','" & mavIpaddress & _
                        "','" & mIpStatus & "','" & mErrorCode & "')"
                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                         
                        
                If mErrorCode = "1001" Then
                    sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
                            "values('" & mLogDate & "','" & mLogTime & "','av','" & UCase(mClient) & "','1001','Invalid Domain')"
                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                End If

        End If
        
        mcompname = " "
        muser = " "
        mspecs = " "
        mlocation = " "
        mcc = " "
        mLastUpdate = " "
        massetno = " "

        
        rs_source.MoveNext
        
        Loop
    End If

End Sub

Private Sub ConvertTextFile8()

    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\savriyadh.csv"
    
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Client" And Trim(MyString) <> "User" And Trim(MyString) <> "Status" _
                And Trim(MyString) <> "Last Scan" And Trim(MyString) <> "Definitions" And Trim(MyString) <> "Version" _
                And Trim(MyString) <> "Scan Engine" And Trim(MyString) <> "Address" And Trim(MyString) <> "Group" _
                And Trim(MyString) <> "Server" Then

            i = i + 1
            
            For X = 1 To Len(MyString)
                Oneletter = Mid(MyString, X, 1)

                DoEvents
                Newstring = Newstring & Oneletter
        
            Next X
                    
            If MyString = "" Then
                Newstring = " "
            End If
            
            Select Case i
                Case 1
                    mClient = Newstring
                Case 2
                    muser = Newstring
                    If InStr(1, UCase(Trim(muser)), "SAUDI-ERICSSON") = 0 Then
                        mIpStatus = "Invalid Domain"
                        mErrorCode = "1001"
                    Else
                        mIpStatus = " "
                        mErrorCode = " "
                    End If
                Case 3
                    mStatus = Newstring
                Case 4
                    mLastScan = Newstring
                Case 5
                    mDefinition = Newstring
                Case 6
                    mVersion = Newstring
                Case 7
                    mScanEngine = Newstring
                Case 8
                    mAddress = Newstring
                    mavIpaddress = Mid(Newstring, 6, 20)
                Case 10
                    mServer = Newstring
                    
                    i = 0
                        'append to and_csv_
                         sSql = "insert into and_csv_av(computer_name,avuser,avstatus,avlastscan," & _
                                "avdefinition,avversion,avscanengine,avaddress,avserver,avbranch,avipaddress,ip_status,error_code) values('" & UCase(mClient) & "','" & _
                                muser & "','" & mStatus & "','" & mLastScan & "','" & mDefinition & "','" & _
                                mVersion & "','" & mScanEngine & "','" & mAddress & "','" & mServer & "','Riyadh','" & mavIpaddress & _
                                "','" & mIpStatus & "','" & mErrorCode & "')"
                         bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                         
                        
                        If mErrorCode = "1001" Then
                            sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
                                     "values('" & mLogDate & "','" & mLogTime & "','av','" & UCase(mClient) & "','1001','Invalid Domain')"
                            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        End If
                        
            End Select
            Newstring = ""
                                
                                
                                
        'Newstring = ""
        'i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertTextFile9()

    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\savjeddah.csv"
    
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Client" And Trim(MyString) <> "User" And Trim(MyString) <> "Status" _
                And Trim(MyString) <> "Last Scan" And Trim(MyString) <> "Definitions" And Trim(MyString) <> "Version" _
                And Trim(MyString) <> "Scan Engine" And Trim(MyString) <> "Address" And Trim(MyString) <> "Group" _
                And Trim(MyString) <> "Server" Then

            i = i + 1
            
            For X = 1 To Len(MyString)
                Oneletter = Mid(MyString, X, 1)

                DoEvents
                Newstring = Newstring & Oneletter
        
            Next X
                    
            If MyString = "" Then
                Newstring = " "
            End If
            
            Select Case i
                Case 1
                    mClient = Newstring
                Case 2
                    muser = Newstring
                    If InStr(1, UCase(Trim(muser)), "SAUDI-ERICSSON") = 0 Then
                        mIpStatus = "Invalid Domain"
                        mErrorCode = "1001"
                    Else
                        mIpStatus = " "
                        mErrorCode = " "
                    End If
                Case 3
                    mStatus = Newstring
                Case 4
                    mLastScan = Newstring
                Case 5
                    mDefinition = Newstring
                Case 6
                    mVersion = Newstring
                Case 7
                    mScanEngine = Newstring
                Case 8
                    mAddress = Newstring
                    mavIpaddress = Mid(Newstring, 6, 20)
                Case 10
                    mServer = Newstring
                    
                    i = 0
                        'append to and_csv_dcadcomputer
                         sSql = "insert into and_csv_av(computer_name,avuser,avstatus,avlastscan," & _
                                "avdefinition,avversion,avscanengine,avaddress,avserver,avbranch,avipaddress,ip_status,error_code) values('" & UCase(mClient) & "','" & _
                                muser & "','" & mStatus & "','" & mLastScan & "','" & mDefinition & "','" & _
                                mVersion & "','" & mScanEngine & "','" & mAddress & "','" & mServer & "','Jeddah','" & mavIpaddress & _
                                "','" & mIpStatus & "','" & mErrorCode & "')"
                         bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                        If mErrorCode = "1001" Then
                            sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
                                     "values('" & mLogDate & "','" & mLogTime & "','av','" & UCase(mClient) & "','1001','Invalid Domain')"
                            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        End If
                         
                        
            End Select
            Newstring = ""
                               
                                
                                
        'Newstring = ""
        'i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertTextFile10()

    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\savdammam.csv"
    
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Client" And Trim(MyString) <> "User" And Trim(MyString) <> "Status" _
                And Trim(MyString) <> "Last Scan" And Trim(MyString) <> "Definitions" And Trim(MyString) <> "Version" _
                And Trim(MyString) <> "Scan Engine" And Trim(MyString) <> "Address" And Trim(MyString) <> "Group" _
                And Trim(MyString) <> "Server" Then

            i = i + 1
            
            For X = 1 To Len(MyString)
                Oneletter = Mid(MyString, X, 1)

                DoEvents
                Newstring = Newstring & Oneletter
        
            Next X
                    
            If MyString = "" Then
                Newstring = " "
            End If
            
            Select Case i
                Case 1
                    mClient = Newstring
                Case 2
                    muser = Newstring
                    If InStr(1, UCase(Trim(muser)), "SAUDI-ERICSSON") = 0 Then
                        mIpStatus = "Invalid Domain"
                        mErrorCode = "1001"
                    Else
                        mIpStatus = " "
                        mErrorCode = " "
                    End If
                Case 3
                    mStatus = Newstring
                Case 4
                    mLastScan = Newstring
                Case 5
                    mDefinition = Newstring
                Case 6
                    mVersion = Newstring
                Case 7
                    mScanEngine = Newstring
                Case 8
                    mAddress = Newstring
                    mavIpaddress = Mid(Newstring, 6, 20)
                Case 10
                    mServer = Newstring
                    
                    i = 0
                        'append to and_csv_dcadcomputer
                         sSql = "insert into and_csv_av(computer_name,avuser,avstatus,avlastscan," & _
                                "avdefinition,avversion,avscanengine,avaddress,avserver,avbranch,avipaddress,ip_status,error_code) values('" & UCase(mClient) & "','" & _
                                muser & "','" & mStatus & "','" & mLastScan & "','" & mDefinition & "','" & _
                                mVersion & "','" & mScanEngine & "','" & mAddress & "','" & mServer & "','Dammam','" & mavIpaddress & _
                                "','" & mIpStatus & "','" & mErrorCode & "')"
                         bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                        
                        If mErrorCode = "1001" Then
                            sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
                                     "values('" & mLogDate & "','" & mLogTime & "','av','" & UCase(mClient) & "','1001','Invalid Domain')"
                            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        End If
                         
                        
            End Select
            Newstring = ""
                                
        'Newstring = ""
        'i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertTextFile10_A()

    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\savstore.csv"
    
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.


        If Trim(MyString) <> "Client" And Trim(MyString) <> "User" And Trim(MyString) <> "Status" _
                And Trim(MyString) <> "Last Scan" And Trim(MyString) <> "Definitions" And Trim(MyString) <> "Version" _
                And Trim(MyString) <> "Scan Engine" And Trim(MyString) <> "Address" And Trim(MyString) <> "Group" _
                And Trim(MyString) <> "Server" Then

            i = i + 1
            
            For X = 1 To Len(MyString)
                Oneletter = Mid(MyString, X, 1)

                DoEvents
                Newstring = Newstring & Oneletter
        
            Next X
                    
            If MyString = "" Then
                Newstring = " "
            End If
            
            Select Case i
                Case 1
                    mClient = Newstring
                Case 2
                    muser = Newstring
                    If InStr(1, UCase(Trim(muser)), "SAUDI-ERICSSON") = 0 Then
                        mIpStatus = "Invalid Domain"
                        mErrorCode = "1001"
                    Else
                        mIpStatus = " "
                        mErrorCode = " "
                    End If
                Case 3
                    mStatus = Newstring
                Case 4
                    mLastScan = Newstring
                Case 5
                    mDefinition = Newstring
                Case 6
                    mVersion = Newstring
                Case 7
                    mScanEngine = Newstring
                Case 8
                    mAddress = Newstring
                    mavIpaddress = Mid(Newstring, 6, 20)
                Case 10
                    mServer = Newstring
                    
                    i = 0
                        'append to and_csv_dcadcomputer
                         sSql = "insert into and_csv_av(computer_name,avuser,avstatus,avlastscan," & _
                                "avdefinition,avversion,avscanengine,avaddress,avserver,avbranch,avipaddress,ip_status,error_code) values('" & UCase(mClient) & "','" & _
                                muser & "','" & mStatus & "','" & mLastScan & "','" & mDefinition & "','" & _
                                mVersion & "','" & mScanEngine & "','" & mAddress & "','" & mServer & "','Store','" & mavIpaddress & _
                                "','" & mIpStatus & "','" & mErrorCode & "')"
                         bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                        
                        If mErrorCode = "1001" Then
                            sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
                                     "values('" & mLogDate & "','" & mLogTime & "','av','" & UCase(mClient) & "','1001','Invalid Domain')"
                            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        End If
                         
                        
            End Select
            Newstring = ""
                                
        'Newstring = ""
        'i = 0

        DoEvents ' it is important To unlock the screen
    End If
        
Loop
Close #1 ' Close file.

End Sub

Private Sub ConvertTextFile11()
    Dim sFileName As String
    Dim sFromFile As String
    Dim aFields As Variant
    
    
    sFileName = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\dns.csv"
    
    Set g_objFileSystem = New Scripting.FileSystemObject
    If Not OpenTextFileR(sFileName) Then
        MsgBox "Cannot open the file : " + sFileName, vbCritical + vbOKOnly
        Exit Sub
    End If
    
        
    Do While Not g_objTextStream.AtEndOfStream ' Loop until End of file.
        sFromFile = g_objTextStream.ReadLine
        aFields = Split(sFromFile, ",")
    


        If aFields(0) <> "Name" And UBound(aFields) < 3 Then

            mcompname = UCase(aFields(0))
            mType = aFields(1)
            mdata = aFields(2)

                'append to and_csv_dcadcomputer
            sSql = "insert into and_csv_dns(computer_name,dns_type,dns_data) values('" & mcompname & "','" & _
                        mType & "','" & mdata & "')"
            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
    
            DoEvents ' it is important To unlock the screen
        End If
        
    Loop

    Set g_objFileSystem = Nothing
End Sub
Private Function OpenTextFileR(sFileName As String) As Boolean
    On Error GoTo ErrOpen

    Set g_objTextStream = g_objFileSystem.OpenTextFile(sFileName, ForReading, False, TristateFalse)
    OpenTextFileR = True
    Exit Function
    
ErrOpen:
    Debug.Print "Err Open file : " + Err.Description
End Function

Private Function OpenRSXLS(strSql As String) As ADODB.Recordset

Dim rs As ADODB.Recordset
        Set rs = New ADODB.Recordset
        rs.CursorLocation = adUseClient
        rs.CursorType = adOpenDynamic
        If IsNull(CnXls) = False Then
            rs.Open strSql, xCnXls, adOpenKeyset, adLockPessimistic
        End If
        Set OpenRSXLS = rs

End Function

Private Sub ConvertTextFile12()
    Dim mcompname As String
    Dim muser As String
    Dim mcc As String
    Dim masset As String
    Dim mBrand As String
    Dim mdesc As String

    Dim sFileName As String
    Dim sFromFile As String
    Dim aFields As Variant
    
    
    sFileName = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\SES Laptops.csv"
    
    Set g_objFileSystem = New Scripting.FileSystemObject
    If Not OpenTextFileR(sFileName) Then
        MsgBox "Cannot open the file : " + sFileName, vbCritical + vbOKOnly
        Exit Sub
    End If
    
        
    Do While Not g_objTextStream.AtEndOfStream ' Loop until End of file.
        sFromFile = g_objTextStream.ReadLine
        aFields = Split(sFromFile, ",")
        
        If aFields(0) <> "Computer Name" Then

            If Not IsNull(aFields(0)) Then
                mcompname = UCase(aFields(0))
            Else
                mcompname = " "
            End If
            
            If Not IsNull(aFields(1)) Then
                muser = aFields(1)
                
                If InStr(1, Trim(muser), "'") > 0 Then
                    muser = Mid(Trim(muser), 1, InStr(1, Trim(muser), "'") - 1) & _
                    Mid(Trim(muser), InStr(1, Trim(muser), "'") + 1, Len(Trim(muser)) - InStr(1, Trim(muser), "'"))
                End If
    
                If InStr(1, Trim(muser), "'") > 0 Then
                    muser = Mid(Trim(muser), 1, InStr(1, Trim(muser), "'") - 1) & _
                    Mid(Trim(muser), InStr(1, Trim(muser), "'") + 1, Len(Trim(muser)) - InStr(1, Trim(muser), "'"))
                End If
                
            Else
                muser = " "
            End If
            
            If Not IsNull(aFields(2)) Then
                mcc = aFields(2)
            Else
                mcc = " "
            End If
            
            
            If Not IsNull(aFields(3)) Then
                masset = aFields(3)
            Else
                masset = " "
            End If
            
            If Not IsNull(aFields(4)) Then
                mSerialno = aFields(4)
            Else
                mSerialno = " "
            End If
            
            
            If Not IsNull(aFields(5)) Then
                mBrand = aFields(5)
            Else
                mBrand = " "
            End If
            
            mdesc = ""
            For i = 6 To UBound(aFields)
                If Not IsNull(aFields(i)) Then
                    mdesc = mdesc & aFields(i)
                End If
            Next i
            
            If mdesc <> "" Then
                
                If InStr(1, Trim(mdesc), "'") > 0 Then
                    mdesc = Mid(Trim(mdesc), 1, InStr(1, Trim(mdesc), "'") - 1) & _
                    Mid(Trim(mdesc), InStr(1, Trim(mdesc), "'") + 1, Len(Trim(mdesc)) - InStr(1, Trim(mdesc), "'"))
                End If
    
                If InStr(1, Trim(mdesc), "'") > 0 Then
                    mdesc = Mid(Trim(mdesc), 1, InStr(1, Trim(mdesc), "'") - 1) & _
                    Mid(Trim(mdesc), InStr(1, Trim(mdesc), "'") + 1, Len(Trim(mdesc)) - InStr(1, Trim(mdesc), "'"))
                End If
                mdesc = Mid(Trim(mdesc), 2, Len(mdesc) - 1)
                mdesc = Mid(Trim(mdesc), 1, Len(mdesc) - 3)
            Else
                mdesc = " "
            End If

            sSql = "insert into and_csv_laptop(computer_name,user_name,cost_centre,asset_no,serial_no,brand,description) " & _
                        "values('" & mcompname & "','" & muser & "','" & mcc & "','" & masset & "','" & mSerialno & "','" & _
                         mBrand & "','" & mdesc & "')"
            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
    
            DoEvents ' it is important To unlock the screen
        End If
        
    Loop

    Set g_objFileSystem = Nothing

End Sub

Private Sub Add_Peripherals()

Dim msql As String
Dim adoRsDesktop As ADODB.Recordset
    
'add a record in and_csv_desktop
msql = "Select computer_name, description, location, user_name, cost_centre, asset_no from and_csv_peripherals"

Set adoRsDesktop = New ADODB.Recordset

adoRsDesktop.Open msql, adoConnection, adOpenDynamic, adLockOptimistic
    
            With adoRsDesktop
                .AddNew
                !computer_name = mcompname
                !Description = mpdesc
                !location = mlocation
                !cost_centre = mcc
                !user_name = muser
                !asset_no = massetno
                .Update
            End With
            adoRsDesktop.Close
            Set adoRsDesktop = Nothing

End Sub

Private Sub Add_Desk1()

Dim msql As String
Dim adoRsDesktop As ADODB.Recordset
    
'add a record in and_csv_desktop
msql = "Select computer_name, user_name, specifications, location, user_cc, last_update, asset_no, remarks, login_name from and_csv_desktop"

Set adoRsDesktop = New ADODB.Recordset

adoRsDesktop.Open msql, adoConnection, adOpenDynamic, adLockOptimistic
    
            With adoRsDesktop
                .AddNew
                !computer_name = mcompname
                !user_name = muser
                !specifications = mspecs
                !location = mlocation
                !user_cc = mcc
                !last_update = mLastUpdate
                !asset_no = massetno
                !login_name = mloginname
                '!remarks = mremarks
                .Update
            End With
            adoRsDesktop.Close
            Set adoRsDesktop = Nothing

End Sub

Private Sub Add_Printer1()

Dim msql As String
Dim adoRsDesktop As ADODB.Recordset
    
'add a record in and_csv_desktop
msql = "Select computer_name, printer_name, location, area, printer_role, cost_centre, serial_no, asset_no from and_csv_printer"

Set adoRsDesktop = New ADODB.Recordset

adoRsDesktop.Open msql, adoConnection, adOpenDynamic, adLockOptimistic
    
            With adoRsDesktop
                .AddNew
                !computer_name = mcompname
                !printer_name = mprinter
                !location = mlocation
                !area = marea
                !printer_role = mprinterrole
                !cost_centre = mcc
                !serial_no = mprintserial
                !asset_no = massetno
                .Update
            End With
            adoRsDesktop.Close
            Set adoRsDesktop = Nothing

End Sub

Private Sub Process_Peripherals()

Set adoConnection = New ADODB.Connection

Connectstring = "Provider=SQLOLEDB.1;Persist Security Info=False;" & _
   "User ID=scheme;Pwd=Er1c550n2;Initial Catalog=Ericsson;Data Source=SESLSVRHO"

adoConnection.Open Connectstring

xCnXls = "Provider=MSDASQL.1;Extended Properties=DBQ=\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\SES Peripherals.xls;Driver={Microsoft Excel Driver (*.xls)};DriverId=790;MaxBufferSize=2048;PageTimeout=5;"

    Dim sourcetble As String
    
    'build query string for excel data
    sourcetble = " SELECT * FROM [SES Peripherals$]"
    
Set rs_source = OpenRSXLS(sourcetble)
    If rs_source.RecordCount <> 0 Then
        Do While Not rs_source.EOF
            DoEvents

          If Not IsNull(rs_source.Fields.Item(0)) Then
                If Not IsNull(rs_source.Fields.Item(0)) Then
                    mcompname = rs_source.Fields.Item(0)
                Else
                    mcompname = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(1)) Then
                    mpdesc = rs_source.Fields.Item(1)
                Else
                    mpdesc = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(2)) Then
                    mlocation = rs_source.Fields.Item(2)
                Else
                    mlocation = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(3)) Then
                    muser = rs_source.Fields.Item(3)
                Else
                    muser = " "
                End If
               
                If Not IsNull(rs_source.Fields.Item(4)) Then
                    mcc = rs_source.Fields.Item(4)
                Else
                    mcc = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(5)) Then
                    massetno = rs_source.Fields.Item(5)
                Else
                    massetno = " "
                End If

         End If
        
        If Trim(mcompname) <> "" Then
            Add_Peripherals
        End If
        
        mcompname = " "
        muser = " "
        mspecs = " "
        mlocation = " "
        mcc = " "
        mLastUpdate = " "
        massetno = " "
        'mremarks = " "
        
        rs_source.MoveNext
        
        Loop
    End If

'delete blank computer name
sSql = "delete from and_csv_peripherals where ltrim(computer_name) = ''"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)


End Sub

Private Sub Process_Desktop1()

Set adoConnection = New ADODB.Connection

Connectstring = "Provider=SQLOLEDB.1;Persist Security Info=False;" & _
   "User ID=scheme;Pwd=Er1c550n2;Initial Catalog=Ericsson;Data Source=SESLSVRHO"

adoConnection.Open Connectstring

xCnXls = "Provider=MSDASQL.1;Extended Properties=DBQ=\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\SES Desktops.xls;Driver={Microsoft Excel Driver (*.xls)};DriverId=790;MaxBufferSize=2048;PageTimeout=5;"

    Dim sourcetble As String
    
    'build query string for excel data
    sourcetble = " SELECT * FROM [Desktops$]"
    
Set rs_source = OpenRSXLS(sourcetble)
    If rs_source.RecordCount <> 0 Then
        Do While Not rs_source.EOF
            DoEvents

          If Not IsNull(rs_source.Fields.Item(0)) Then
                If Not IsNull(rs_source.Fields.Item(0)) Then
                    mcompname = rs_source.Fields.Item(0)
                Else
                    mcompname = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(1)) Then
                    muser = rs_source.Fields.Item(1)
                Else
                    muser = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(2)) Then
                    mspecs = rs_source.Fields.Item(2)
                Else
                    mspecs = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(3)) Then
                    mlocation = rs_source.Fields.Item(3)
                Else
                    mlocation = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(4)) Then
                    mcc = rs_source.Fields.Item(4)
                Else
                    mcc = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(5)) Then
                    massetno = rs_source.Fields.Item(5)
                Else
                    massetno = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(6)) Then
                    mLastUpdate = rs_source.Fields.Item(6)
                Else
                    mLastUpdate = " "
                End If

         End If
        
        If Trim(mcompname) <> "" Then
            Add_Desk1
        End If
        
        mcompname = " "
        muser = " "
        mspecs = " "
        mlocation = " "
        mcc = " "
        mLastUpdate = " "
        massetno = " "
        'mremarks = " "
        
        rs_source.MoveNext
        
        Loop
    End If

'delete blank computer name
sSql = "delete from and_csv_desktop where ltrim(computer_name) = ''"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

'update and_csv_details
sSql = "update and_csv_details set laptop_tag = '3' where computer_name in (Select computer_name from and_csv_desktop)"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

End Sub

Private Sub Process_Printer()

Set adoConnection = New ADODB.Connection

Connectstring = "Provider=SQLOLEDB.1;Persist Security Info=False;" & _
   "User ID=scheme;Pwd=Er1c550n2;Initial Catalog=Ericsson;Data Source=SESLSVRHO"

adoConnection.Open Connectstring

xCnXls = "Provider=MSDASQL.1;Extended Properties=DBQ=\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\SES Printers.xls;Driver={Microsoft Excel Driver (*.xls)};DriverId=790;MaxBufferSize=2048;PageTimeout=5;"

    Dim sourcetble As String
    
    'build query string for excel data
    sourcetble = " SELECT * FROM [SES Printers$]"
    
Set rs_source = OpenRSXLS(sourcetble)
    If rs_source.RecordCount <> 0 Then
        Do While Not rs_source.EOF
            DoEvents

          If Not IsNull(rs_source.Fields.Item(0)) Then
                If Not IsNull(rs_source.Fields.Item(0)) Then
                    mcompname = rs_source.Fields.Item(0)
                Else
                    mcompname = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(1)) Then
                    mprinter = rs_source.Fields.Item(1)
                Else
                    mprinter = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(2)) Then
                    mlocation = rs_source.Fields.Item(2)
                Else
                    mlocation = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(3)) Then
                    marea = rs_source.Fields.Item(3)
                Else
                    marea = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(4)) Then
                    mprinterrole = rs_source.Fields.Item(4)
                Else
                    mprinterrole = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(5)) Then
                    mcc = rs_source.Fields.Item(5)
                Else
                    mcc = " "
                End If

                If Not IsNull(rs_source.Fields.Item(6)) Then
                    mprintserial = rs_source.Fields.Item(6)
                Else
                    mprintserial = " "
                End If

                If Not IsNull(rs_source.Fields.Item(7)) Then
                    massetno = rs_source.Fields.Item(7)
                Else
                    massetno = " "
                End If
         
         End If
    
         'insert into and_csv_desktop
        'sSql = "insert into and_csv_desktop(computer_name,user_name,specifications,location,user_cc,asset_no,remarks) " & _
                "values ('" & mcompname & "','" & muser & "','" & mspecs & "','" & mlocation & "','" & _
                mcc & "','" & mlastupdate & "','" & massetno & "','" & mremarks & "')"
        'bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
        
        If Trim(mcompname) <> "" Then
            If Trim(mcompname) <> "Computer Name" Then
                Add_Printer1
            End If
        End If
        
        mcompname = " "
        mprinter = " "
        mlocation = " "
        marea = " "
        mprinterrole = " "
        mcc = " "
        mprintserial = " "
        massetno = " "
        
        rs_source.MoveNext
        
        Loop
    End If

'delete blank computer name
sSql = "delete from and_csv_printer where ltrim(computer_name) = ''"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

'update and_csv_details
'sSql = "update and_csv_details set laptop_tag = '3' where computer_name in (Select computer_name from and_csv_desktop)"
'bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

End Sub

Private Sub Process_Desktop2()

xCnXls = "Provider=MSDASQL.1;Extended Properties=DBQ=\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\Desktops.xls;Driver={Microsoft Excel Driver (*.xls)};DriverId=790;MaxBufferSize=2048;PageTimeout=5;"

    Dim sourcetble As String
    
    Dim xcompname As String
    
    'build query string for excel data
    sourcetble = " SELECT * FROM [Not on the List$]"
    
Set rs_source = OpenRSXLS(sourcetble)
    If rs_source.RecordCount <> 0 Then
        Do While Not rs_source.EOF
            DoEvents

          If Not IsNull(rs_source.Fields.Item(0)) Then
                
                If Not IsNull(rs_source.Fields.Item(1)) Then
                    xcompname = rs_source.Fields.Item(1)
                Else
                    xcompname = " "
                End If

         End If
    
         'insert into and_csv_desktop
        sSql = "insert into and_csv_desktop(computer_name) values('" & xcompname & "')"
        bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
        
        rs_source.MoveNext
        
        Loop
    End If

End Sub

Private Sub CmdMsUpdate_Click()

MousePointer = vbHourglass

Dim mstatus1 As Long
Dim mstatus2 As Long
Dim mstatus3 As Long
Dim mstatus4 As Long
Dim mpercent As Double
Dim mpercent2 As Long


Dim mstatus5 As Long
Dim mstatus6 As Long


If gUpdateWinUpdate = 0 Then

    'delete and insert from and_csv_msupdate_prev
    sSql = "delete from and_csv_msupdate_prev"
    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)


    sSql = "insert into and_csv_msupdate_prev Select computer_name, update_with_error, " & _
            "updates_needed, curr_msupdate from and_csv_consolidated where curr_msupdate is not null"
    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
    
    'get Last date and time - MS Update
    sSql = "Select max(Last_Status_Update) as Last_Date from and_symantec_summarized"
    If DataAccess.GetRecordset(sConnectSQL, sSql, oRs4) Then

        gMSDate = Format(oRs4!Last_Date, "dd-mm-yyyy")
        gMSTime = Format(oRs4!Last_Date, "hh:mm")

    End If
    oRs4.Close
    Set oRs4 = Nothing

End If

'delete from csv_error
sSql = "delete from SES.scheme.and_csv_error where log_source = 'windows'"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)


'update and_csv_consolidated with null values
sSql = "update and_csv_consolidated set installed_na_percent = null, update_with_error = null, updates_needed = null," & _
        "updates_installed = null, updates_with_nostatus = null, download_status = null, pending_reboot = null," & _
        "last_status_update = null, curr_msupdate = null, " & _
        "ms_unregistered_ip = null, ms_unregistered_device = null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)


'delete from
sSql = "delete from SES.scheme.and_symantec_summarized"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "delete from SES.scheme.and_csv_fulldomain"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "INSERT INTO SES.scheme.and_symantec_summarized(FullDomainName, IPAddress, Last_Status_Update, OS_Language, Service_Pack, Computer_Maker, " & _
        "Model, Processor, BIOS_ver) SELECT tbComputerTarget.FullDomainName, tbComputerTarget.IPAddress, tbComputerTarget.LastReportedStatusTime, " & _
        "tbComputerTargetDetail.OSLocale, tbComputerTargetDetail.OSServicePackMajorNumber, tbComputerTargetDetail.ComputerMake, " & _
        "tbComputerTargetDetail.ComputerModel, tbComputerTargetDetail.ProcessorArchitecture, tbComputerTargetDetail.BiosVersion " & _
        "FROM tbComputerTarget LEFT JOIN tbComputerTargetDetail ON tbComputerTarget.TargetID = tbComputerTargetDetail.TargetID"
bExec = DataAccess.ExecQuery(sConnectSQLSUSDB, sSql)


sSql = "insert into SES.scheme.and_csv_fulldomain SELECT tbComputerTarget.FullDomainName, tbTargetGroup.Name FROM (SESLSVRHO.SUSDB.dbo.tbTargetGroup " & _
        "INNER JOIN SESLSVRHO.SUSDB.dbo.tbTargetInTargetGroup ON tbTargetGroup.TargetGroupID = tbTargetInTargetGroup.TargetGroupID) " & _
        "INNER JOIN SESLSVRHO.SUSDB.dbo.tbComputerTarget ON tbTargetInTargetGroup.TargetID = tbComputerTarget.TargetID"
        '& _
        '"where tbTargetGroup.Name = 'Approved Computers'"
bExec = DataAccess.ExecQuery(sConnectSQLSUSDB, sSql)


'delete all computers which target group <> Approved Computers
'sSql = "delete from SES.scheme.and_symantec_summarized where FullDomainName not in(SELECT FullDomainName from SES.scheme.and_csv_fulldomain)"
'bExec = DataAccess.ExecQuery(sConnectSQLSUSDB, sSql)


'delete from
sSql = "delete from SES.scheme.and_symantec_1"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "insert into SES.scheme.and_symantec_1 " & _
        "select  FullDomainName, UnKnown, NotInstalled, Downloaded, Installed, Failed, InstalledPendingReboot " & _
        "from tbComputerSummaryForMicrosoftUpdates a inner join tbComputerTarget b on a.TargetID = b.TargetID"
bExec = DataAccess.ExecQuery(sConnectSQLSUSDB, sSql)


'count updates installed/not applicable
sSql = "Select count(*) as count9 from tbUpdateSummaryForAllComputers a inner join tbUpdate b " & _
            "on a.LocalUpdateID = b.LocalUpdateID inner join PUBLIC_VIEWS.vUpdate c on b.UpdateID = c.UpdateID"

If DataAccess.GetRecordset(sConnectSQLSUSDB, sSql, oRs) Then
    If oRs.RecordCount > 0 Then
        gCount9 = oRs!count9
    End If
End If
oRs.Close
Set oRs = Nothing

'process
sSql = "Select FullDomainName from SES.scheme.and_symantec_summarized order by FullDomainName"
If DataAccess.GetRecordset(sConnectSQLSUSDB, sSql, oRs) Then
    Do Until oRs.EOF
        gDomainname = Trim(oRs!FullDomainName)
        
        'get from symantec1 - updates with errors
        sSql = "Select Failed, Downloaded, InstalledPendingReboot from SES.scheme.and_symantec_1 where FullDomainName = '" & gDomainname & "'"
        If DataAccess.GetRecordset(sConnectSQLSUSDB, sSql, oRs2) Then
            If oRs2.RecordCount > 0 Then
                mstatus1 = oRs2!Failed
                mstatus5 = oRs2!Downloaded
                mstatus6 = oRs2!InstalledPendingReboot
            Else
                mstatus1 = 0
            End If
        
        End If
        oRs2.Close
        Set oRs2 = Nothing
        
        'get from symantec2 - updates needed
        sSql = "Select Unknown, NotInstalled, Downloaded from SES.scheme.and_symantec_1 where FullDomainName = '" & gDomainname & "'"
        If DataAccess.GetRecordset(sConnectSQLSUSDB, sSql, oRs2) Then
            If oRs2.RecordCount > 0 Then
                mstatus4 = oRs2!Unknown
                mstatus2 = oRs2!NotInstalled + oRs2!Downloaded
            Else
                mstatus4 = 0
                mstatus2 = 0
            End If
        
        End If
        oRs2.Close
        Set oRs2 = Nothing
        
        
        'mstatus3 = gCount9 - (mstatus1 + mstatus2 + mstatus4)
        mstatus3 = gCount9 - (mstatus1 + mstatus2 + mstatus4 + mstatus6)
    
         
        If mstatus3 = 0 Then
            mpercent = 0
        Else
            'mpercent = (mstatus1 + mstatus2 + mstatus4) / mstatus3 * 100
            mpercent = mstatus3 / gCount9 * 100
        End If
    
        
    
        If mpercent = 0 Then
            If mstatus3 = 0 Then
                mpercent = 0
            Else
                mpercent = 100
            End If
        'Else
        '    mpercent = Fix(100 - mpercent)
            
        End If
        
        If mpercent = 100 Then
            mpercent2 = mpercent
        Else
            mpercent2 = Int(mpercent)
        End If
        
        sSql = "update SES.scheme.and_symantec_summarized set Installed_NA_Percent = '" & mpercent2 & _
                        "', Status1 = '" & mstatus1 & "', Status2 = '" & mstatus2 & "', Status3 = '" & _
                        mstatus3 & "', Status4 = '" & mstatus4 & "', Status6 = '" & mstatus6 & _
                        "', Status5 = '" & mstatus5 & "' where FullDomainName = '" & _
                        gDomainname & "'"
        bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
        
        oRs.MoveNext
    Loop
End If
oRs.Close
Set oRs = Nothing

CheckMSUpdateVsCsv


'get Last date and time - MS Update
sSql = "Select max(Last_Status_Update) as Last_Date from and_symantec_summarized"
If DataAccess.GetRecordset(sConnectSQL, sSql, oRs4) Then

    gMSDate2 = Format(oRs4!Last_Date, "dd-mm-yyyy")
    gMSTime2 = Format(oRs4!Last_Date, "hh:mm")

End If
oRs4.Close
Set oRs4 = Nothing

If gMSTime <> gMSTime2 Then
    UpdatePrevAVDate
End If


CmdMsUpdate.Enabled = False
MousePointer = vbDefault

End Sub

Private Sub CheckMSUpdateVsCsv()

Dim minstalledpercent As Double
Dim mipaddress As String
Dim mLastUpdate As String
Dim mstatus1 As String
Dim mstatus2 As String
Dim mstatus3 As String
Dim mstatus4 As String
Dim mstatus5 As String
Dim mstatus6 As String
Dim mGroupDesc As String


'sSql = "Select FullDomainName, Installed_NA_Percent, IPAddress, Last_Status_Update, Status1, Status2, Status3, Status4, " & _
'            "Status5, Status6 from and_symantec_summarized order by FullDomainName"
            
sSql = "Select a.FullDomainName, a.Installed_NA_Percent, a.IPAddress, a.Last_Status_Update, a.Status1, a.Status2, a.Status3, " & _
            "a.Status4, a.Status5, a.Status6, b.GroupDescription from SES.scheme.and_symantec_summarized a inner join " & _
            "SES.scheme.and_csv_fulldomain b on a.FullDomainName = b.FullDomainName order by a.FullDomainName"
            
If DataAccess.GetRecordset(sConnectSQL, sSql, oRs) Then
    
    Do Until oRs.EOF
           
            If InStr(1, Trim(oRs!FullDomainName), ".") > 0 Then
                mcompname = UCase(Mid(Trim(oRs!FullDomainName), 1, InStr(1, Trim(oRs!FullDomainName), ".") - 1))
            Else
                mcompname = UCase(Trim(oRs!FullDomainName))
            End If

           mClientIp = Trim(oRs!ipaddress)
           minstalledpercent = oRs!installed_na_percent
           mLastUpdate = Format(oRs!last_status_update, "dd mmm yyyy")
           mstatus1 = oRs!Status1
           mstatus2 = oRs!Status2
           mstatus3 = oRs!Status3
           mstatus4 = oRs!Status4
           mstatus5 = oRs!Status5
           mstatus6 = oRs!Status6
           mGroupDesc = Trim(oRs!GroupDescription)
           
            
            'check if existing in and_csv_consolidated
            sSql = "Select computer_name, installed_na_percent, update_with_error, updates_needed, curr_msupdate from and_csv_consolidated where computer_name = '" & Trim(mcompname) & "'"
            If DataAccess.GetRecordset(sConnectSQL, sSql, oRs2) Then
                If oRs2.RecordCount > 0 Then
                    'update info
                    If Not IsNull(oRs2!installed_na_percent) Then
                        If oRs2!installed_na_percent = 100 Then
                                    sSql = "update and_csv_consolidated set installed_na_percent = " & _
                                            minstalledpercent & ", last_status_update = '" & _
                                            mLastUpdate & "', curr_msupdate = '" & mLastUpdate & _
                                            "', update_with_error = '" & mstatus1 & "', updates_needed = '" & _
                                            mstatus2 & "', updates_installed = '" & mstatus3 & _
                                            "', updates_with_nostatus = '" & mstatus4 & "', download_status = '" & _
                                            mstatus5 & "', pending_reboot = '" & mstatus6 & _
                                            "', prev_update_with_error = '" & Trim(oRs2!update_with_error) & _
                                            "', prev_updates_needed = '" & Trim(oRs2!updates_needed) & _
                                            "', prev_msupdate = '" & Format(oRs2!curr_msupdate, "dd mmm yyyy") & "', ms_tag_error1 = '0' where computer_name = '" & Trim(mcompname) & "'"
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

                        
                        Else
                                'check if there is changes
                                If Trim(oRs2!update_with_error) <> Trim(mstatus1) And Trim(oRs2!updates_needed) <> Trim(mstatus2) Then
                                    sSql = "update and_csv_consolidated set installed_na_percent = " & _
                                            minstalledpercent & ", last_status_update = '" & _
                                            mLastUpdate & "', curr_msupdate = '" & mLastUpdate & _
                                            "', update_with_error = '" & mstatus1 & "', updates_needed = '" & _
                                            mstatus2 & "', updates_installed = '" & mstatus3 & _
                                            "', updates_with_nostatus = '" & mstatus4 & "', download_status = '" & _
                                            mstatus5 & "', pending_reboot = '" & mstatus6 & _
                                            "', prev_update_with_error = '" & Trim(oRs2!update_with_error) & _
                                            "', prev_updates_needed = '" & Trim(oRs2!updates_needed) & _
                                            "', prev_msupdate = '" & Format(oRs2!curr_msupdate, "dd mmm yyyy") & "', ms_tag_error1 = '1' where computer_name = '" & Trim(mcompname) & "'"
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                                Else
                                
                                    sSql = "update and_csv_consolidated set installed_na_percent = " & _
                                            minstalledpercent & ", last_status_update = '" & _
                                            mLastUpdate & "', curr_msupdate = '" & mLastUpdate & _
                                            "', update_with_error = '" & mstatus1 & "', updates_needed = '" & _
                                            mstatus2 & "', updates_installed = '" & mstatus3 & _
                                            "', updates_with_nostatus = '" & mstatus4 & "', download_status = '" & _
                                            mstatus5 & "', pending_reboot = '" & mstatus6 & _
                                            "', prev_update_with_error = '" & Trim(oRs2!update_with_error) & _
                                            "', prev_updates_needed = '" & Trim(oRs2!updates_needed) & _
                                            "', prev_msupdate = '" & Format(oRs2!curr_msupdate, "dd mmm yyyy") & "', ms_tag_error1 = '0' where computer_name = '" & Trim(mcompname) & "'"
                                    
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                
                                End If
                        End If
                    
                    
                    Else
                        'first run
                        sSql = "update and_csv_consolidated set installed_na_percent = " & _
                                    minstalledpercent & ", last_status_update = '" & _
                                    mLastUpdate & "', update_with_error = '" & mstatus1 & "', updates_needed = '" & _
                                    mstatus2 & "', updates_installed = '" & mstatus3 & _
                                    "', updates_with_nostatus = '" & mstatus4 & "', download_status = '" & _
                                    mstatus5 & "', pending_reboot = '" & mstatus6 & _
                                    "', curr_msupdate = '" & mLastUpdate & "' where computer_name = '" & Trim(mcompname) & "'"
                        bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                    End If
                
                    'check ip
                    sSql = "Select computer_name from and_csv_consolidated where client_ipaddress1 = '" & _
                                mClientIp & "' or client_ipaddress2 = '" & mClientIp & "' or client_ipaddress3 = '" & _
                                mClientIp & "'"
                    If DataAccess.GetRecordset(sConnectSQL, sSql, oRs3) Then
                        If oRs3.RecordCount = 0 Then
                            If mGroupDesc = "Approved Computers" Then
                                
                                sSql = "update and_csv_consolidated set ms_unregistered_ip = '1' where computer_name = '" & Trim(mcompname) & "'"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                
                                'ERROR LOG
                            
                                sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(mLogDate) & "','" & Trim(mLogTime) & _
                                        "','windows','" & mcompname & "','Unregistered IP','" & Trim(mClientIp) & "')"
                                 
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            End If
                                
                                
                        End If
                    End If
                    oRs3.Close
                    Set oRs3 = Nothing
                    
            
                Else
                    
                        If mGroupDesc = "Approved Computers" Then
                        
                            sSql = "insert into and_csv_consolidated(computer_name,source,file_source," & _
                                "ms_unregistered_device) values('" & Trim(mcompname) & "','WN', 'windows','1')"
                            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                        
                        'first run
                        sSql = "update and_csv_consolidated set installed_na_percent = " & _
                                    minstalledpercent & ", last_status_update = '" & _
                                    mLastUpdate & "', update_with_error = '" & mstatus1 & "', updates_needed = '" & _
                                    mstatus2 & "', updates_installed = '" & mstatus3 & _
                                    "', updates_with_nostatus = '" & mstatus4 & "', download_status = '" & _
                                    mstatus5 & "', pending_reboot = '" & mstatus6 & _
                                    "', curr_msupdate = '" & mLastUpdate & "' where computer_name = '" & Trim(mcompname) & "'"
                        bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                
                        'ERROR LOG
                        
                            sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(mLogDate) & "','" & Trim(mLogTime) & _
                                        "','windows','" & mcompname & "','Unregistered Device','" & Trim(mClientIp) & "')"
                                 
                            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        End If
                
                End If
            End If
            oRs2.Close
            Set oRs2 = Nothing
            

        oRs.MoveNext
    Loop
End If
oRs.Close
Set oRs = Nothing

End Sub

Private Sub CmdNoIE8_Click()

MousePointer = vbHourglass

sSql = "delete from and_csv_ie8"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

'NewConvertExcelIE8XP
NewConvertExcelNoIE8_1
NewConvertExcelNoIE8_2

'NewConvertExcelIE8Vista
'NewConvertExcelIE82003

'sSql = "delete from and_csv_ie8 where computer_name in(Select computer_name from and_csv_ie8 where status <> 'Not Applicable')"
sSql = "delete from scheme.and_csv_ie8 where computer_name not in(Select computer_name from scheme.and_csv_consolidated)"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

MousePointer = vbDefault

CmdNoIE8.Enabled = False

End Sub

Private Sub CmdSvAntiVirus_Click()

MousePointer = vbHourglass

Dim mType As String

Dim mStatus As String
Dim mautoprotect As String
Dim minfected As String
Dim mavengine As String
Dim mtamper As String
Dim mThreat As String
Dim mRestart As String

Dim mipadd As String
Dim mipadd2 As String
Dim mipadd3 As String
Dim mipadd4 As String

Dim mgateway As String
Dim mMac As String

Dim mMac2 As String
Dim mMac3 As String
Dim mMac4 As String

Dim mDns As String

Dim mVersion As String
Dim mLastUpdate As String

Dim mGroupName As String

'update unique_id
sSql = "update and_csv_consolidated set unique_id1 = '' where unique_id1 is null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_consolidated set unique_id2 = '' where unique_id2 is null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_consolidated set unique_id3 = '' where unique_id3 is null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)


'initialize and_csv_consolidated set fields to ' '

sSql = "delete from and_csv_antivirus"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "delete from SES.scheme.and_csv_error where log_source = 'Symantec'"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

'update to null all sv fields
sSql = "update and_csv_consolidated set sv_status = null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_consolidated set sv_autoprotect = null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_consolidated set sv_infected = null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_consolidated set sv_engine_on = null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_consolidated set sv_tamper_protect = null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_consolidated set sv_restart = null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_consolidated set sv_network_threat = null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_consolidated set sv_unregistered_device = null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_consolidated set sv_unregistered_ip = null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_consolidated set sv_unregistered_mac = null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_consolidated set sv_unregistered_gateway = null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_consolidated set sv_unregistered_dns = null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)


ConvertTextFileAV

sSql = "delete from and_csv_antivirus where Version = 'Version'"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)


'delete
'sSql = "delete from and_csv_antivirus where [Group Name] <> 'My Company\Jeddah' and substring([Group Name],1,21) <> 'My Company\Desktop PC' " & _
'            "and [Group Name] <> 'My Company\Laptops' and [Group Name] <> 'My Company\Server'"
'bExec = DataAccess.ExecQuery(sConnectSQL, sSql)



'process anti-virus
sSql = "Select Status, [Auto-Protect on] as autoprotect, Infected, [Antivirus engine on] as avengine, " & _
            "[Tamper Protection On] as tamperon, [Computer Name] as computer_name, " & _
            "[IP Address1] as ipaddress, Gateway1, [MAC Address1] as macaddress, [DNS server 1] as dnserver, " & _
            "[Network Threat Protection On] as NetworkThreat, [Restart Required] as restart, Version, " & _
            "[IP Address2] as ipaddress2, [IP Address3] as ipaddress3, [IP Address4] as ipaddress4, " & _
            "[MAC Address2] as macaddress2, [MAC Address3] as macaddress3, [MAC Address4] as macaddress4, " & _
            "[Last Update Time] as LastUpdate, [Group Name] as GroupName from and_csv_antivirus"
If DataAccess.GetRecordset(sConnectSQL, sSql, oRs) Then
    
    Do Until oRs.EOF
    
            mcompname = UCase(Trim(oRs!computer_name))
            mVersion = Trim(oRs!Version)
            mLastUpdate = Trim(oRs!LastUpdate)
            mGroupName = Trim(oRs!GroupName)
                        
            If Trim(oRs!Status) = "No" Then
                mStatus = "1"
            Else
                mStatus = " "
            End If
            
            If Trim(oRs!autoprotect) = "No" Then
                mautoprotect = "1"
            Else
                mautoprotect = " "
            End If
                        
            If Trim(oRs!Infected) = "Yes" Then
                minfected = "1"
            Else
                minfected = " "
            End If

            If Trim(oRs!avengine) = "No" Then
                mavengine = "1"
            Else
                mavengine = " "
            End If
            
            If Trim(oRs!tamperon) = "No" Then
                mtamper = "1"
            Else
                mtamper = " "
            End If
            
            If Trim(oRs!restart) = "Yes" Then
                mRestart = "1"
            Else
                mRestart = " "
            End If
            
                        
            If Trim(oRs!NetworkThreat) = "No" Then
                mThreat = "1"
            Else
                mThreat = " "
            End If

            mipadd = Trim(oRs!ipaddress)
            
            If Trim(oRs!ipaddress2) = "" Then
                mipadd2 = ""
            Else
                mipadd2 = Trim(oRs!ipaddress2)
            End If
            
            If Trim(oRs!ipaddress3) = "" Then
                mipadd3 = ""
            Else
                mipadd3 = Trim(oRs!ipaddress3)
            End If
            
            If Trim(oRs!ipaddress4) = "" Then
                mipadd4 = ""
            Else
                mipadd4 = Trim(oRs!ipaddress4)
            End If

            
            mgateway = Trim(oRs!Gateway1)
            '12345678901234567
            '00-13-e8-6c-e7-75
            
            mMac = Mid(Trim(oRs!macaddress), 1, 2) & Mid(Trim(oRs!macaddress), 4, 2) & _
                    Mid(Trim(oRs!macaddress), 7, 2) & Mid(Trim(oRs!macaddress), 10, 2) & _
                    Mid(Trim(oRs!macaddress), 13, 2) & Mid(Trim(oRs!macaddress), 16, 2)
            
            If Trim(oRs!macaddress2) = "" Then
                mMac2 = ""
            Else
                mMac2 = Mid(Trim(oRs!macaddress2), 1, 2) & Mid(Trim(oRs!macaddress2), 4, 2) & _
                    Mid(Trim(oRs!macaddress2), 7, 2) & Mid(Trim(oRs!macaddress2), 10, 2) & _
                    Mid(Trim(oRs!macaddress2), 13, 2) & Mid(Trim(oRs!macaddress2), 16, 2)
            End If
            
            If Trim(oRs!macaddress3) = "" Then
                mMac3 = ""
            Else
                mMac3 = Mid(Trim(oRs!macaddress3), 1, 2) & Mid(Trim(oRs!macaddress3), 4, 2) & _
                    Mid(Trim(oRs!macaddress3), 7, 2) & Mid(Trim(oRs!macaddress3), 10, 2) & _
                    Mid(Trim(oRs!macaddress3), 13, 2) & Mid(Trim(oRs!macaddress3), 16, 2)
            End If
            
            If Trim(oRs!macaddress4) = "" Then
                mMac4 = ""
            Else
                mMac4 = Mid(Trim(oRs!macaddress4), 1, 2) & Mid(Trim(oRs!macaddress4), 4, 2) & _
                    Mid(Trim(oRs!macaddress4), 7, 2) & Mid(Trim(oRs!macaddress4), 10, 2) & _
                    Mid(Trim(oRs!macaddress4), 13, 2) & Mid(Trim(oRs!macaddress4), 16, 2)
            End If
            
            mDns = Trim(oRs!dnserver)
            
            
            'check if existing in and_csv_consolidated
            sSql = "Select computer_name, type, client_ipaddress1, client_ipaddress2, client_ipaddress3, unique_id1, " & _
                        "unique_id2, unique_id3 from and_csv_consolidated where computer_name = '" & Trim(mcompname) & "'"
            
            If DataAccess.GetRecordset(sConnectSQL, sSql, oRs2) Then
                If oRs2.RecordCount > 0 Then
                
                    If Not IsNull(oRs2!Type) Then
                    
                        mType = oRs2!Type
                        
                    Else
                        mType = "XXX"
                    End If
                    
                    sSql = "update and_csv_consolidated set sv_status = '" & mStatus & _
                            "', sv_autoprotect = '" & mautoprotect & _
                            "', sv_infected = '" & minfected & _
                            "', sv_engine_on = '" & mavengine & _
                            "', sv_tamper_protect = '" & mtamper & _
                            "', sv_restart = '" & mRestart & _
                            "', sv_network_threat = '" & mThreat & _
                            "', sv_version = '" & mVersion & _
                            "', sv_last_update = '" & mLastUpdate & "' where computer_name = '" & Trim(mcompname) & "'"
                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                    
                    
                    'check ip
                    If mipadd <> Trim(oRs2!client_ipaddress1) And mipadd <> Trim(oRs2!client_ipaddress2) _
                            And mipadd <> Trim(oRs2!client_ipaddress3) Then
                            
                        'check exception
                        If Trim(mipadd) <> "0.0.0.0" And Mid(Trim(mipadd), 1, 8) <> "169.254." And _
                                Mid(Trim(mipadd), 1, 10) <> "192.168.25" And Mid(Trim(mipadd), 1, 10) <> "192.168.21" And _
                                mMac <> "005345000000" Then
                                
                            
                                If mGroupName = "My Company\Jeddah" Or Mid(mGroupName, 1, 21) = "My Company\Desktop PC" Or _
                                     mGroupName = "My Company\Laptops" Or mGroupName = "My Company\Server" Then
                            
                                    sSql = "update and_csv_consolidated set sv_unregistered_ip = '1' " & _
                                            "where computer_name = '" & Trim(mcompname) & "'"
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            
                                    'ERROR LOG
                                        sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                                    "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                                    Trim(mLogTime) & "','" & Trim(gAVDate) & "','" & Trim(gAVTime) & _
                                                    "','Symantec','" & mcompname & "','Unregistered IP','" & Trim(mipadd) & "')"
                                 
                                        bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                End If
                        End If
                    End If
                    
                    
                    'check ip2
                    If Trim(mipadd2) <> "" Then
                        If mipadd2 <> Trim(oRs2!client_ipaddress1) And mipadd2 <> Trim(oRs2!client_ipaddress2) _
                            And mipadd2 <> Trim(oRs2!client_ipaddress3) Then
                            
                        'check exception
                        If Trim(mipadd2) <> "0.0.0.0" And Mid(Trim(mipadd2), 1, 8) <> "169.254." And _
                                Mid(Trim(mipadd2), 1, 10) <> "192.168.25" And Mid(Trim(mipadd2), 1, 10) <> "192.168.21" And _
                                mMac2 <> "005345000000" Then
                            
                                If mGroupName = "My Company\Jeddah" Or Mid(mGroupName, 1, 21) = "My Company\Desktop PC" Or _
                                     mGroupName = "My Company\Laptops" Or mGroupName = "My Company\Server" Then
                            
                                    sSql = "update and_csv_consolidated set sv_unregistered_ip = '1' " & _
                                        "where computer_name = '" & Trim(mcompname) & "'"
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            
                                'ERROR LOG
                                
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gAVDate) & "','" & Trim(gAVTime) & _
                                        "','Symantec','" & mcompname & "','Unregistered IP','" & Trim(mipadd2) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                End If
                        End If
                        End If
                    End If
                    
                    'check ip3
                    If Trim(mipadd3) <> "" Then
                        If mipadd3 <> Trim(oRs2!client_ipaddress1) And mipadd3 <> Trim(oRs2!client_ipaddress2) _
                            And mipadd3 <> Trim(oRs2!client_ipaddress3) Then
                            
                        'check exception
                        If Trim(mipadd3) <> "0.0.0.0" And Mid(Trim(mipadd3), 1, 8) <> "169.254." And _
                                Mid(Trim(mipadd3), 1, 10) <> "192.168.25" And Mid(Trim(mipadd3), 1, 10) <> "192.168.21" And _
                                mMac3 <> "005345000000" Then
                                
                                If mGroupName = "My Company\Jeddah" Or Mid(mGroupName, 1, 21) = "My Company\Desktop PC" Or _
                                     mGroupName = "My Company\Laptops" Or mGroupName = "My Company\Server" Then
                                
                                
                                    sSql = "update and_csv_consolidated set sv_unregistered_ip = '1' " & _
                                        "where computer_name = '" & Trim(mcompname) & "'"
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            
                                    'ERROR LOG
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gAVDate) & "','" & Trim(gAVTime) & _
                                        "','Symantec','" & mcompname & "','Unregistered IP','" & Trim(mipadd3) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                End If
                        End If
                        End If
                    End If
                    
                    'check ip4
                    If Trim(mipadd4) <> "" Then
                        If mipadd4 <> Trim(oRs2!client_ipaddress1) And mipadd4 <> Trim(oRs2!client_ipaddress2) _
                            And mipadd4 <> Trim(oRs2!client_ipaddress3) Then
                            
                        'check exception
                        If Trim(mipadd4) <> "0.0.0.0" And Mid(Trim(mipadd4), 1, 8) <> "169.254." And _
                                Mid(Trim(mipadd4), 1, 10) <> "192.168.25" And Mid(Trim(mipadd4), 1, 10) <> "192.168.21" And _
                                mMac4 <> "005345000000" Then
                            
                            
                                If mGroupName = "My Company\Jeddah" Or Mid(mGroupName, 1, 21) = "My Company\Desktop PC" Or _
                                     mGroupName = "My Company\Laptops" Or mGroupName = "My Company\Server" Then
                            
                                        sSql = "update and_csv_consolidated set sv_unregistered_ip = '1' " & _
                                                "where computer_name = '" & Trim(mcompname) & "'"
                                        bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            
                                    'ERROR LOG
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gAVDate) & "','" & Trim(gAVTime) & _
                                        "','Symantec','" & mcompname & "','Unregistered IP','" & Trim(mipadd4) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                End If
                                
                        End If
                        End If
                    End If
                    
                    
                    'check mac address
                    If mMac <> Trim(oRs2!unique_id1) And mMac <> Trim(oRs2!unique_id2) _
                            And mMac <> Trim(oRs2!unique_id3) Then
                            
                        'check exception
                        If Trim(mipadd) <> "0.0.0.0" And Mid(Trim(mipadd), 1, 8) <> "169.254." And _
                                Mid(Trim(mipadd), 1, 10) <> "192.168.25" And Mid(Trim(mipadd), 1, 10) <> "192.168.21" And _
                                mMac <> "005345000000" Then
                                
                                
                                If mGroupName = "My Company\Jeddah" Or Mid(mGroupName, 1, 21) = "My Company\Desktop PC" Or _
                                     mGroupName = "My Company\Laptops" Or mGroupName = "My Company\Server" Then
                            
                                        sSql = "update and_csv_consolidated set sv_unregistered_mac = '1' " & _
                                                "where computer_name = '" & Trim(mcompname) & "'"
                                        bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            
                                        'ERROR LOG
                                        sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                                "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                                Trim(mLogTime) & "','" & Trim(gAVDate) & "','" & Trim(gAVTime) & _
                                                "','Symantec','" & mcompname & "','Unregistered MAC Address','" & Trim(mMac) & "')"
                                 
                                        bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                End If
                        End If
                    End If
                    
                    'check mac address2
                    If Trim(mMac2) <> "" Then
                        If mMac2 <> Trim(oRs2!unique_id1) And mMac2 <> Trim(oRs2!unique_id2) _
                                And mMac2 <> Trim(oRs2!unique_id3) Then
                            
                        'check exception
                        If Trim(mipadd2) <> "0.0.0.0" And Mid(Trim(mipadd2), 1, 8) <> "169.254." And _
                                Mid(Trim(mipadd2), 1, 10) <> "192.168.25" And Mid(Trim(mipadd2), 1, 10) <> "192.168.21" And _
                                mMac2 <> "005345000000" Then
                            
                                If mGroupName = "My Company\Jeddah" Or Mid(mGroupName, 1, 21) = "My Company\Desktop PC" Or _
                                     mGroupName = "My Company\Laptops" Or mGroupName = "My Company\Server" Then
                            
                                    sSql = "update and_csv_consolidated set sv_unregistered_mac = '1' " & _
                                        "where computer_name = '" & Trim(mcompname) & "'"
                                        bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            
                                    'ERROR LOG
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gAVDate) & "','" & Trim(gAVTime) & _
                                        "','Symantec','" & mcompname & "','Unregistered MAC Address','" & Trim(mMac2) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                End If
                        End If
                        End If
                    End If
                    
                    'check mac address3
                    If Trim(mMac3) <> "" Then
                        If mMac3 <> Trim(oRs2!unique_id1) And mMac3 <> Trim(oRs2!unique_id2) _
                                And mMac3 <> Trim(oRs2!unique_id3) Then
                            
                        'check exception
                        If Trim(mipadd3) <> "0.0.0.0" And Mid(Trim(mipadd3), 1, 8) <> "169.254." And _
                                Mid(Trim(mipadd3), 1, 10) <> "192.168.25" And Mid(Trim(mipadd3), 1, 10) <> "192.168.21" And _
                                mMac3 <> "005345000000" Then
                            
                                If mGroupName = "My Company\Jeddah" Or Mid(mGroupName, 1, 21) = "My Company\Desktop PC" Or _
                                     mGroupName = "My Company\Laptops" Or mGroupName = "My Company\Server" Then
                            
                                        sSql = "update and_csv_consolidated set sv_unregistered_mac = '1' " & _
                                                "where computer_name = '" & Trim(mcompname) & "'"
                                        bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            
                                    'ERROR LOG
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gAVDate) & "','" & Trim(gAVTime) & _
                                        "','Symantec','" & mcompname & "','Unregistered MAC Address','" & Trim(mMac3) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                End If
                        End If
                        End If
                    End If
                    
                    'check mac address4
                    If Trim(mMac4) <> "" Then
                        If mMac4 <> Trim(oRs2!unique_id1) And mMac4 <> Trim(oRs2!unique_id2) _
                                And mMac4 <> Trim(oRs2!unique_id3) Then
                            
                                If mGroupName = "My Company\Jeddah" Or Mid(mGroupName, 1, 21) = "My Company\Desktop PC" Or _
                                     mGroupName = "My Company\Laptops" Or mGroupName = "My Company\Server" Then
                            
                                    sSql = "update and_csv_consolidated set sv_unregistered_mac = '1' " & _
                                            "where computer_name = '" & Trim(mcompname) & "'"
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            
                                    'ERROR LOG
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gAVDate) & "','" & Trim(gAVTime) & _
                                        "','Symantec','" & mcompname & "','Unregistered MAC Address','" & Trim(mMac4) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                End If
                        End If
                    End If
                    
                    
                    'check Gateway
                    sSql = "Select ipadd as gateway, type from and_csv_dns_gateway where ipadd = '" & mgateway & "'"
                    If DataAccess.GetRecordset(sConnectSQL, sSql, oRs3) Then
                        If oRs3.RecordCount = 0 Then
                            
                            
                                If mGroupName = "My Company\Jeddah" Or Mid(mGroupName, 1, 21) = "My Company\Desktop PC" Or _
                                     mGroupName = "My Company\Laptops" Or mGroupName = "My Company\Server" Then
                            
                                    sSql = "update and_csv_consolidated set sv_unregistered_gateway = '1' " & _
                                            "where computer_name = '" & Trim(mcompname) & "'"
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            
                                    'ERROR LOG
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gAVDate) & "','" & Trim(gAVTime) & _
                                        "','Symantec','" & mcompname & "','Unregistered Gateway','" & Trim(mgateway) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                End If
                        Else
                            
                            If Trim(oRs3!Type) = "Server" Then
                                If Trim(mType) <> "Server" Then
                                
                                If mGroupName = "My Company\Jeddah" Or Mid(mGroupName, 1, 21) = "My Company\Desktop PC" Or _
                                     mGroupName = "My Company\Laptops" Or mGroupName = "My Company\Server" Then
                                
                                        sSql = "update and_csv_consolidated set sv_unregistered_gateway = '1' " & _
                                                "where computer_name = '" & Trim(mcompname) & "'"
                                        bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            
                                        'ERROR LOG
                                        sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                                "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                                Trim(mLogTime) & "','" & Trim(gAVDate) & "','" & Trim(gAVTime) & _
                                                "','Symantec','" & mcompname & "','Unregistered Gateway','" & Trim(mgateway) & "')"
                                 
                                        bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                End If
                                
                                End If
                            End If
                        
                        End If
                    End If
                    oRs3.Close
                    Set oRs3 = Nothing
                    
                    'check DNS
                    sSql = "Select ipadd as dns, type from and_csv_dns_gateway where ipadd = '" & mDns & "'"
                    If DataAccess.GetRecordset(sConnectSQL, sSql, oRs3) Then
                        If oRs3.RecordCount = 0 Then
                        
                            If mGroupName = "My Company\Jeddah" Or Mid(mGroupName, 1, 21) = "My Company\Desktop PC" Or _
                                     mGroupName = "My Company\Laptops" Or mGroupName = "My Company\Server" Then
                            
                            
                                    sSql = "update and_csv_consolidated set sv_unregistered_dns = '1' " & _
                                            "where computer_name = '" & Trim(mcompname) & "'"
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            
                                    'ERROR LOG
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gAVDate) & "','" & Trim(gAVTime) & _
                                        "','Symantec','" & mcompname & "','Unregistered DNS','" & Trim(mDns) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                    
                            End If
                        
                        Else
                            If Trim(oRs3!Type) = "Server" Then
                                If Trim(mType) <> "Server" Then
                                
                                If mGroupName = "My Company\Jeddah" Or Mid(mGroupName, 1, 21) = "My Company\Desktop PC" Or _
                                     mGroupName = "My Company\Laptops" Or mGroupName = "My Company\Server" Then
                                
                                
                                    sSql = "update and_csv_consolidated set sv_unregistered_dns = '1' " & _
                                            "where computer_name = '" & Trim(mcompname) & "'"
                                            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            
                                    'ERROR LOG
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gAVDate) & "','" & Trim(gAVTime) & _
                                        "','Symantec','" & mcompname & "','Unregistered DNS','" & Trim(mDns) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                    
                                End If
                                
                                End If
                            End If
                        End If
                    End If
                    oRs3.Close
                    Set oRs3 = Nothing
            
                Else
                    
                If mGroupName = "My Company\Jeddah" Or Mid(mGroupName, 1, 21) = "My Company\Desktop PC" Or _
                                     mGroupName = "My Company\Laptops" Or mGroupName = "My Company\Server" Then
                    
                    
                    sSql = "insert into and_csv_consolidated(computer_name,source,file_source," & _
                                "sv_unregistered_device) values('" & Trim(mcompname) & _
                                        "','SV', 'symantec','1')"
                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                

                            'ERROR LOG
                            sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gAVDate) & "','" & Trim(gAVTime) & _
                                        "','Symantec','" & mcompname & "','Unregistered Device','" & Trim(mipadd) & "')"
                                 
                            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                End If
                
                
                End If
            End If


        oRs.MoveNext
    Loop
End If
oRs.Close
Set oRs = Nothing

CmdSvAntiVirus.Enabled = False

MousePointer = vbDefault

End Sub

Private Function ConvertTextFileAV()

    Dim X
    Dim i
    Dim Y
    Dim z
    
    Dim mctr As Integer
    
    Dim MyString As String
    Dim Newstring As String
    Dim Oneletter
    Dim sSourceFile
    
    Dim m4 As String
    Dim m20 As String
    Dim m21 As String
    Dim m33 As String
    Dim m34 As String
    Dim m36 As String
    Dim m37 As String
    Dim m38 As String
    Dim m39 As String
    Dim m40 As String
    Dim m43 As String
    Dim m45 As String
    Dim m59 As String
    Dim m63 As String
    Dim m67 As String
    Dim m71 As String
    Dim m80 As String
    Dim m82 As String
    Dim m84 As String
    
    Dim m60 As String
    Dim m61 As String
    Dim m62 As String
    
    Dim m68 As String
    Dim m69 As String
    Dim m70 As String
  
  
    sSourceFile = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\sav.txt"
    
    'get date and time
    gAVDate = Format(FileDateTime(sSourceFile), "dd mmm yyyy")
    gAVTime = Format(FileDateTime(sSourceFile), "hh:mm")
    
    
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    mctr = 0
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.

        'mctr = mctr + 1

        'If Mid(MyString, 1, 5) <> "Saudi" And Mid(MyString, 1, 6) <> "Report" And _
            Mid(MyString, 1, 9) <> "Extension" And Mid(MyString, 1, 7) <> "Filters" And _
            Mid(MyString, 1, 9) <> "Reporting" And Mid(MyString, 1, 10) <> "Connecting" And _
            Mid(MyString, 1, 5) <> "Party" And Mid(MyString, 1, 7) <> "Overall" And _
            Mid(MyString, 1, 5) <> "Local" And Mid(MyString, 1, 3) <> "STD" And Mid(MyString, 1, 3) <> "ISD" And _
            Mid(MyString, 1, 3) <> "All" And Mid(MyString, 1, 8) <> "Internal" And Mid(MyString, 1, 8) <> "< End" Then

            'For X = 1 To Len(MyString)
            '    Oneletter = Mid(MyString, X, 1)
                
                    i = i + 1
                    Select Case i
                    Case 4
                        m4 = Trim(MyString)
                    Case 20
                        m20 = Trim(MyString)
                    Case 21
                        m21 = Trim(MyString)
                    Case 33
                        m33 = Trim(MyString)
                    Case 34
                        m34 = Trim(MyString)
                    Case 36
                        m36 = Trim(MyString)
                    Case 37
                        m37 = Trim(MyString)
                    'Case 38
                    '    m38 = Trim(MyString)
                    Case 39
                        m39 = Trim(MyString)
                    Case 40
                        m40 = Trim(MyString)
                    Case 43
                        m43 = Trim(MyString)
                    Case 45
                        m45 = Trim(MyString)
                    Case 59
                        m59 = Trim(MyString)
                    Case 60
                        m60 = Trim(MyString)
                        If m60 = "..." Then
                            m60 = ""
                        End If
                    Case 61
                        m61 = Trim(MyString)
                        If m61 = "..." Then
                            m61 = ""
                        End If
                        
                    Case 62
                        m62 = Trim(MyString)
                        If m62 = "..." Then
                            m62 = ""
                        End If
                        
                    Case 63
                        m63 = Trim(MyString)
                    Case 67
                        m67 = Trim(MyString)
                    Case 68
                        m68 = Trim(MyString)
                    Case 69
                        m69 = Trim(MyString)
                    Case 70
                        m70 = Trim(MyString)
                    Case 71
                        m71 = Trim(MyString)
                    Case 80
                        m80 = Trim(MyString)
                    Case 82
                        m82 = Trim(MyString)
                        If InStr(1, Trim(m82), "'") > 0 Then
                            m82 = Mid(Trim(m82), 1, InStr(1, Trim(m82), "'") - 1)
                        Else
                            m82 = m82
                        End If
                        
                    Case 84
                        m84 = Trim(MyString)
                        If InStr(1, Trim(m84), "'") > 0 Then
                            m84 = Mid(Trim(m84), 1, InStr(1, Trim(m84), "'") - 1)
                        Else
                            m84 = UCase(m84)
                        End If
                        
                        
                    Case 85
                        
                        i = 0
                        
                        sSql = "insert into and_csv_antivirus(Version, Status, [Last Update Time], [Auto-Protect on], Infected, [Last Scan Time], [Last Virus Time]," & _
                                "[Antivirus engine on], [Tamper Protection On], [Restart Required], [Computer Name],[IP Address1],Gateway1,[MAC Address1],[DNS server 1]," & _
                                "[Network Threat Protection On],[Current User],[Group Name],[IP Address2],[IP Address3],[IP Address4],[MAC Address2],[MAC Address3],[MAC Address4]) " & _
                                "values('" & m4 & "','" & m20 & _
                                "','" & m21 & "','" & m33 & "','" & m34 & "','" & m36 & "','" & m37 & "','" & m39 & _
                                "','" & m40 & "','" & m43 & "','" & m45 & "','" & m59 & "','" & m63 & "','" & m67 & "','" & m71 & _
                                "','" & m80 & "','" & m84 & "','" & m82 & "','" & m60 & "','" & m61 & "','" & m62 & "','" & _
                                m68 & "','" & m69 & "','" & m70 & "')"
                                
                        bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                    
                    
                    End Select
                    
                    Newstring = ""
            
                'Else
                
                '    DoEvents
                '    Newstring = Newstring & Oneletter
            
                
                'End If
        
            'Next X
                                
                                
        Newstring = ""
        'i = 0

        DoEvents ' it is important To unlock the screen
   ' End If
        
Loop
Close #1 ' Close file.

End Function

Private Sub CmdUpdate_Click()
    
MousePointer = vbHourglass
    
Dim mctr As Integer
Dim merrfield As String
Dim mValuedesc As String
Dim mErrLogdesc As String
Dim msg

'msg = MsgBox("Is there a new SAV.txt?", vbYesNo + vbQuestion, "Message")
'If msg = vbYes Then
'    MsgBox "Edit helal and said...Debug to check if and_csv_av_param is ok...."
'    End

'End If

    
GetServerDateTime
    
'update and_csv_lastupdate
sSql = "update and_csv_lastupdate set update_date = '" & mLogDate & "', update_time = '" & mLogTime & "'"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
    
    
mctr = 0
   
gUpdateWinUpdate = 1
   
'delete and insert from and_csv_msupdate_prev
sSql = "delete from and_csv_msupdate_prev"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)


sSql = "insert into and_csv_msupdate_prev Select computer_name, update_with_error, " & _
            "updates_needed, curr_msupdate from and_csv_consolidated where curr_msupdate is not null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
    
'get Last date and time - MS Update
sSql = "Select max(Last_Status_Update) as Last_Date from and_symantec_summarized"
If DataAccess.GetRecordset(sConnectSQL, sSql, oRs4) Then

    gMSDate = Format(oRs4!Last_Date, "dd-mm-yyyy")
    gMSTime = Format(oRs4!Last_Date, "hh:mm")

End If
oRs4.Close
Set oRs4 = Nothing
    
    
    
sSql = "delete from and_csv_consolidated"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
    
sSql = "delete from and_csv_dcadcomputer"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "delete from and_csv_dns"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "delete from and_csv_dhcp"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "delete from and_csv_error"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)


sSql = "delete from and_csv_desktop"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "delete from and_csv_laptop"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "delete from and_csv_desktop_laptop"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)


ConvertAdComputerCSV

ConvertDcComputerCsv
ConvertIpPhoneCsv

'dns
ConvertDnsCsv

'dhcp
ConvertDHCPCsvOne
ConvertDHCPCsvEleven
ConvertDHCPCsvTwelve
ConvertDHCPCsvThirteen
ConvertDHCPCsvFifteen
ConvertDHCPCsvOneHundred

ConvertDHCPCsvSixteen

ConvertDHCPCsvSvr

ConvertDHCPCsvLandDevice

'Consolidation
sSql = "insert into and_csv_consolidated(computer_name,source,type) " & _
        "Select computer_name, source, type from and_csv_dcadcomputer"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
'update ip addresses
sSql = "update and_csv_consolidated set client_ipaddress1 = ' ', client_ipaddress2 = ' ', " & _
            "client_ipaddress3 = ' '"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)


'Desktop
ConvertDesktopXls

sSql = "Select computer_name, user_cc, user_name from and_csv_desktop order by computer_name"
If DataAccess.GetRecordset(sConnectSQL, sSql, oRs) Then
    
    Do Until oRs.EOF
    
            mcompname = Trim(oRs!computer_name)
            mcc = Trim(oRs!user_cc)
            
            'check if existing in and_csv_consolidated
            sSql = "Select computer_name from and_csv_consolidated where computer_name = '" & Trim(mcompname) & "'"
            If DataAccess.GetRecordset(sConnectSQL, sSql, oRs2) Then
                If oRs2.RecordCount > 0 Then
                    sSql = "update and_csv_consolidated set desktop_laptop_tag = 'D', cost_centre = '" & mcc & _
                            "', desktop_laptop_user = '" & Trim(oRs!user_name) & "' where computer_name = '" & Trim(mcompname) & "'"
                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
            
                Else
                    sSql = "insert into and_csv_consolidated(computer_name,source,file_source," & _
                                "desktop_laptop_notconnected,desktop_laptop_tag,cost_centre,desktop_laptop_user) values('" & Trim(mcompname) & _
                                        "','DL', 'desktop','1','D','" & mcc & "','" & Trim(oRs!user_name) & "')"
                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                
                                'ERROR LOG
                            'sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                            '            "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                            '            Trim(mLogTime) & "','" & Trim(gDesktopDate) & "','" & Trim(gDesktopTime) & _
                            '            "','Desktop','" & mcompname & "','Not Connected','" & Trim(mcompname) & "')"
                                 
                            'bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                
                End If
            End If


        oRs.MoveNext
    Loop
End If
oRs.Close
Set oRs = Nothing

'insert into and_csv_desktop_laptop
sSql = "insert into and_csv_desktop_laptop(computer_name,user_name,specifications,location,user_cc,last_update,asset_no,login_name,tag) " & _
        "Select computer_name,user_name,specifications,location,user_cc,last_update,asset_no,login_name,'D' as tag from and_csv_desktop"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

'update null values
sSql = "update and_csv_consolidated set desktop_laptop_notconnected = '' where desktop_laptop_notconnected is null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)


'Laptop
ConvertLaptopXls

sSql = "Select computer_name, cost_centre, user_name from and_csv_laptop order by computer_name"
If DataAccess.GetRecordset(sConnectSQL, sSql, oRs) Then
    
    Do Until oRs.EOF
    
            mcompname = Trim(oRs!computer_name)
            mcc = Trim(oRs!cost_centre)
            
            
            'check if existing in and_csv_consolidated
            sSql = "Select computer_name from and_csv_consolidated where computer_name = '" & Trim(mcompname) & "'"
            If DataAccess.GetRecordset(sConnectSQL, sSql, oRs2) Then
                If oRs2.RecordCount > 0 Then
                    sSql = "update and_csv_consolidated set desktop_laptop_tag = 'L', cost_centre = '" & mcc & _
                            "', desktop_laptop_user = '" & Trim(oRs!user_name) & "' where computer_name = '" & Trim(mcompname) & "'"
                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
            
                Else
                    sSql = "insert into and_csv_consolidated(computer_name,source,file_source," & _
                                "desktop_laptop_notconnected,desktop_laptop_tag,cost_centre,desktop_laptop_user) values('" & Trim(mcompname) & _
                                        "','DL', 'laptop','1','L','" & mcc & "','" & Trim(oRs!user_name) & "')"
                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                
                                'ERROR LOG
                            'sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                            '            "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                            '            Trim(mLogTime) & "','" & Trim(gLaptopDate) & "','" & Trim(gLaptopTime) & _
                            '            "','Laptop','" & mcompname & "','Not Connected','" & Trim(mcompname) & "')"
                                 
                            'bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                
                End If
            End If


        oRs.MoveNext
    Loop
End If
oRs.Close
Set oRs = Nothing

'insert into and_csv_desktop_laptop
sSql = "insert into and_csv_desktop_laptop(computer_name,user_name,specifications,user_cc,asset_no,laptop_brand,laptop_serial,login_name,tag) " & _
        "Select computer_name,user_name,description,cost_centre,asset_no,brand,serial_no,login_name,'L' as tag from and_csv_laptop"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

'update null values
sSql = "update and_csv_consolidated set desktop_laptop_notconnected = '' where desktop_laptop_notconnected is null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

'update and_csv_desktop_laptop
sSql = "update and_csv_desktop_laptop set con_tag = 'N' where computer_name in(Select computer_name from and_csv_consolidated where desktop_laptop_notconnected = '1')"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_desktop_laptop set con_tag = 'C' where con_tag is null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

    
    'dhcp
sSql = "Select computer_name, client_ipaddress, dhcp_source, dhcp_name, dhcp_description, err_desc, unique_id from and_csv_dhcp order by computer_name, lease_expiration"
If DataAccess.GetRecordset(sConnectSQL, sSql, oRs) Then
    If oRs.RecordCount > 0 Then
    mcompname = oRs!computer_name

    Do Until oRs.EOF
        If mcompname = oRs!computer_name Then
            mctr = mctr + 1
            mcompname = oRs!computer_name
            mClientIp = oRs!client_ipaddress
            mUniqueId = oRs!unique_id
            mdhcpdesc = oRs!dhcp_description
            
            
            Select Case Trim(oRs!err_desc)
                Case "Invalid Domain"
                    merrfield = "dhcp_invalid_domain_1"
                    mValuedesc = oRs!dhcp_name
                    mErrLogdesc = "Invalid Domain"
                Case "Inactive"
                    merrfield = "dhcp_inactive_1"
                    mValuedesc = mClientIp
                    mErrLogdesc = "Inactive"
                Case ""
                    merrfield = "none"
            End Select
    
            'check if existing in and_csv_consolidated
            sSql = "Select computer_name from and_csv_consolidated where computer_name = '" & _
                        Trim(mcompname) & "'"
            If DataAccess.GetRecordset(sConnectSQL, sSql, oRs2) Then
                If oRs2.RecordCount > 0 Then
                    Select Case mctr
                        Case 1
                            If merrfield = "none" Then
                                sSql = "update and_csv_consolidated set client_ipaddress1 = '" & _
                                        Trim(mClientIp) & "', file_source = 'dhcp" & _
                                        Trim(oRs!dhcp_source) & "', unique_id1 = '" & Trim(mUniqueId) & _
                                        "', unique_id_desc = '" & Trim(mdhcpdesc) & "' where computer_name = '" & Trim(mcompname) & "'"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            Else
                                sSql = "update and_csv_consolidated set client_ipaddress1 = '" & _
                                        Trim(mClientIp) & "', file_source = 'dhcp" & _
                                        Trim(oRs!dhcp_source) & "'," & merrfield & " = '1', unique_id1 = '" & _
                                        Trim(mUniqueId) & "', unique_id_desc = '" & Trim(mdhcpdesc) & "' where computer_name = '" & Trim(mcompname) & "'"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            
                            'error log
                            Select Case Trim(oRs!dhcp_source)
                                Case "1"
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcp1Date) & "','" & Trim(gDhcp1Time) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','" & mErrLogdesc & "','" & Trim(mValuedesc) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                                Case "11"
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcp11Date) & "','" & Trim(gDhcp11Time) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','" & mErrLogdesc & "','" & Trim(mValuedesc) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                                Case "12"
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcp12Date) & "','" & Trim(gDhcp12Time) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','" & mErrLogdesc & "','" & Trim(mValuedesc) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                        
                                Case "13"
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcp13Date) & "','" & Trim(gDhcp13Time) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','" & mErrLogdesc & "','" & Trim(mValuedesc) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                                Case "15"
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcp15Date) & "','" & Trim(gDhcp15Time) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','" & mErrLogdesc & "','" & Trim(mValuedesc) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                        
                                Case "100"
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcp100Date) & "','" & Trim(gDhcp100Time) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','" & mErrLogdesc & "','" & Trim(mValuedesc) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                                Case "svr"
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcpSvrDate) & "','" & Trim(gDhcpSvrTime) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','" & mErrLogdesc & "','" & Trim(mValuedesc) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                        
                                Case "land"
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcpLandDate) & "','" & Trim(gDhcpLandTime) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','" & mErrLogdesc & "','" & Trim(mValuedesc) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            End Select
                                 
                                
                            End If
                        Case 2
                            If merrfield = "none" Then
                                sSql = "update and_csv_consolidated set client_ipaddress2 = '" & _
                                        Trim(mClientIp) & "', unique_id2 = '" & Trim(mUniqueId) & _
                                        "', unique_id_desc = '" & Trim(mdhcpdesc) & "' where computer_name = '" & Trim(mcompname) & "'"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            Else
                                sSql = "update and_csv_consolidated set client_ipaddress2 = '" & _
                                        Trim(mClientIp) & "'," & merrfield & " = '1', unique_id2 = '" & Trim(mUniqueId) & _
                                        "', unique_id_desc = '" & Trim(mdhcpdesc) & "' where computer_name = '" & Trim(mcompname) & "'"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                
                            'error log
                            Select Case Trim(oRs!dhcp_source)
                                Case "1"
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcp1Date) & "','" & Trim(gDhcp1Time) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','" & mErrLogdesc & "','" & Trim(mValuedesc) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                                Case "11"
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcp11Date) & "','" & Trim(gDhcp11Time) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','" & mErrLogdesc & "','" & Trim(mValuedesc) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                                Case "12"
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcp12Date) & "','" & Trim(gDhcp12Time) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','" & mErrLogdesc & "','" & Trim(mValuedesc) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                        
                                Case "13"
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcp13Date) & "','" & Trim(gDhcp13Time) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','" & mErrLogdesc & "','" & Trim(mValuedesc) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                                Case "15"
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcp15Date) & "','" & Trim(gDhcp15Time) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','" & mErrLogdesc & "','" & Trim(mValuedesc) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                        
                                Case "100"
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcp100Date) & "','" & Trim(gDhcp100Time) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','" & mErrLogdesc & "','" & Trim(mValuedesc) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                                Case "svr"
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcpSvrDate) & "','" & Trim(gDhcpSvrTime) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','" & mErrLogdesc & "','" & Trim(mValuedesc) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                        
                                Case "land"
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcpLandDate) & "','" & Trim(gDhcpLandTime) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','" & mErrLogdesc & "','" & Trim(mValuedesc) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            End Select
                                
                            End If
                        Case 3
                            If merrfield = "none" Then
                                sSql = "update and_csv_consolidated set client_ipaddress3 = '" & _
                                        Trim(mClientIp) & "', unique_id3 = '" & Trim(mUniqueId) & _
                                        "', unique_id_desc = '" & Trim(mdhcpdesc) & "' where computer_name = '" & Trim(mcompname) & "'"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            Else
                                sSql = "update and_csv_consolidated set client_ipaddress3 = '" & _
                                        Trim(mClientIp) & "'," & merrfield & " = '1', unique_id3 = '" & Trim(mUniqueId) & _
                                        "', unique_id_desc = '" & Trim(mdhcpdesc) & "' where computer_name = '" & Trim(mcompname) & "'"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                
                            'error log
                            Select Case Trim(oRs!dhcp_source)
                                Case "1"
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcp1Date) & "','" & Trim(gDhcp1Time) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','" & mErrLogdesc & "','" & Trim(mValuedesc) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                                Case "11"
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcp11Date) & "','" & Trim(gDhcp11Time) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','" & mErrLogdesc & "','" & Trim(mValuedesc) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                                Case "12"
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcp12Date) & "','" & Trim(gDhcp12Time) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','" & mErrLogdesc & "','" & Trim(mValuedesc) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                        
                                Case "13"
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcp13Date) & "','" & Trim(gDhcp13Time) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','" & mErrLogdesc & "','" & Trim(mValuedesc) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                                Case "15"
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcp15Date) & "','" & Trim(gDhcp15Time) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','" & mErrLogdesc & "','" & Trim(mValuedesc) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                        
                                Case "100"
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcp100Date) & "','" & Trim(gDhcp100Time) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','" & mErrLogdesc & "','" & Trim(mValuedesc) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                                Case "svr"
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcpSvrDate) & "','" & Trim(gDhcpSvrTime) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','" & mErrLogdesc & "','" & Trim(mValuedesc) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                        
                                Case "land"
                                    sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcpLandDate) & "','" & Trim(gDhcpLandTime) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','" & mErrLogdesc & "','" & Trim(mValuedesc) & "')"
                                 
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            End Select
                                
                            
                            End If
                    End Select
                Else
                    sSql = "insert into and_csv_consolidated(computer_name,source,file_source,client_ipaddress1," & _
                                "dhcp_unregistered_device,unique_id1,unique_id_desc) values('" & Trim(mcompname) & "','DHCP', 'dhcp" & _
                                 Trim(oRs!dhcp_source) & "','" & Trim(mClientIp) & "','1','" & Trim(mUniqueId) & _
                                        "','" & Trim(mdhcpdesc) & "')"
                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                    
                    Select Case Trim(oRs!dhcp_source)
                        Case "1"
                            sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcp1Date) & "','" & Trim(gDhcp1Time) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','Unregistered Device','" & Trim(mClientIp) & "')"
                                 
                            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                        Case "11"
                            sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcp11Date) & "','" & Trim(gDhcp11Time) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','Unregistered Device','" & Trim(mClientIp) & "')"
                                 
                            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                        Case "12"
                            sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcp12Date) & "','" & Trim(gDhcp12Time) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','Unregistered Device','" & Trim(mClientIp) & "')"
                                 
                            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                        
                        Case "13"
                            sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcp13Date) & "','" & Trim(gDhcp13Time) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','Unregistered Device','" & Trim(mClientIp) & "')"
                                 
                            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                        Case "15"
                            sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcp15Date) & "','" & Trim(gDhcp15Time) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','Unregistered Device','" & Trim(mClientIp) & "')"
                                 
                            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                        
                        Case "100"
                            sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcp100Date) & "','" & Trim(gDhcp100Time) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','Unregistered Device','" & Trim(mClientIp) & "')"
                                 
                            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                        
                        Case "svr"
                            sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcpSvrDate) & "','" & Trim(gDhcpSvrTime) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','Unregistered Device','" & Trim(mClientIp) & "')"
                                 
                            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                        Case "land"
                            sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDhcpLandDate) & "','" & Trim(gDhcpLandTime) & _
                                        "','dhcp" & Trim(oRs!dhcp_source) & "','" & mcompname & "','Unregistered Device','" & Trim(mClientIp) & "')"
                                 
                            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                        
                    
                    End Select
                    
                End If
            End If
            oRs2.Close
            Set oRs2 = Nothing
            
            
            oRs.MoveNext
        Else
            mcompname = oRs!computer_name
            mctr = 0
            
        End If
            
    
        'oRs.MoveNext
    Loop
    End If
End If
oRs.Close
Set oRs = Nothing

'update null values
sSql = "update and_csv_consolidated set unique_id_desc = '' where unique_id_desc is null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

'update desktop_laptop_user
sSql = "update and_csv_consolidated set desktop_laptop_user = [unique_id_desc] where desktop_laptop_user is null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

'process server and dc server
sSql = "insert into and_csv_desktop_laptop(computer_name,login_name,user_name,tag,con_tag) " & _
            "Select computer_name, 'IT.Support' as login_name, unique_id_desc as user_name, 'S' as tag, 'C' as con_tag from and_csv_consolidated " & _
            "where type = 'Server' or type = 'DC Server'"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)


'DNS
sSql = "Select computer_name, dns_data from and_csv_dns where computer_name <> '(SAME AS PARENT FOLDER)' " & _
            "and dns_data <> '' order by dns_data"
If DataAccess.GetRecordset(sConnectSQL, sSql, oRs) Then
    
    Do Until oRs.EOF
        If Val(Mid(oRs!dns_data, 1, 1)) <> 0 Then
            
            mcompname = Trim(oRs!computer_name)
            mClientIp = Trim(oRs!dns_data)
            
            'check if existing in and_csv_consolidated
            sSql = "Select computer_name from and_csv_consolidated where computer_name = '" & Trim(mcompname) & "'"
            If DataAccess.GetRecordset(sConnectSQL, sSql, oRs2) Then
                If oRs2.RecordCount > 0 Then
                    'check ip
                    sSql = "Select computer_name from and_csv_consolidated where client_ipaddress1 = '" & _
                                mClientIp & "' or client_ipaddress2 = '" & mClientIp & "' or client_ipaddress3 = '" & _
                                mClientIp & "'"
                    If DataAccess.GetRecordset(sConnectSQL, sSql, oRs3) Then
                        If oRs3.RecordCount = 0 Then
                                sSql = "update and_csv_consolidated set dns_unregistered_ip = '1' where computer_name = '" & Trim(mcompname) & "'"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                
                                'ERROR LOG
                            sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDnsDate) & "','" & Trim(gDnsTime) & _
                                        "','dns','" & mcompname & "','Unregistered IP','" & Trim(mClientIp) & "')"
                                 
                            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                
                                
                        End If
                    End If
                    oRs3.Close
                    Set oRs3 = Nothing
            
                Else
                    sSql = "insert into and_csv_consolidated(computer_name,source,file_source," & _
                                "dns_unregistered_device) values('" & Trim(mcompname) & "','**DNS', 'dns','1')"
                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                
                                'ERROR LOG
                            sSql = "insert into and_csv_error(update_date,update_time,file_date,file_time,log_source," & _
                                        "computer_name,log_description,value_desc) values('" & Trim(mLogDate) & "','" & _
                                        Trim(mLogTime) & "','" & Trim(gDnsDate) & "','" & Trim(gDnsTime) & _
                                        "','dns','" & mcompname & "','Unregistered Device','" & Trim(mClientIp) & "')"
                                 
                            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                
                End If
            End If
            oRs2.Close
            Set oRs2 = Nothing
            
            
        End If


        oRs.MoveNext
    Loop
End If
oRs.Close
Set oRs = Nothing

MsgBox "Finished.....", vbOKOnly + vbInformation, "Message"

'End

CmdUpdate.Enabled = False

MousePointer = vbDefault
    
End Sub

Private Sub ConvertLaptopXls()

Dim sFileName As String

sFileName = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\SES Laptops.xls"

    'get date and time
    gLaptopDate = Format(FileDateTime(sFileName), "dd mmm yyyy")
    gLaptopTime = Format(FileDateTime(sFileName), "hh:mm")

mcompname = " "

Set adoConnection = New ADODB.Connection

Connectstring = "Provider=SQLOLEDB.1;Persist Security Info=False;" & _
   "User ID=scheme;Pwd=Er1c550n2;Initial Catalog=SES;Data Source=SESLSVRHO"

adoConnection.Open Connectstring

xCnXls = "Provider=MSDASQL.1;Extended Properties=DBQ=\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\SES Laptops.xls;Driver={Microsoft Excel Driver (*.xls)};DriverId=790;MaxBufferSize=2048;PageTimeout=5;"

    Dim sourcetble As String
    
    'build query string for excel data
    sourcetble = " SELECT * FROM [SES Laptops$]"
    
Set rs_source = OpenRSXLS(sourcetble)
    If rs_source.RecordCount <> 0 Then
        Do While Not rs_source.EOF
            DoEvents

          If Not IsNull(rs_source.Fields.Item(19)) Then
          
                If Not IsNull(rs_source.Fields.Item(4)) Then
                    muser = rs_source.Fields.Item(4)
                Else
                    muser = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(3)) Then
                    mspecs = rs_source.Fields.Item(3)
                Else
                    mspecs = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(6)) Then
                    mcc = rs_source.Fields.Item(6)
                Else
                    mcc = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(0)) Then
                    massetno = rs_source.Fields.Item(0)
                Else
                    massetno = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(2)) Then
                    mBrand = rs_source.Fields.Item(2)
                Else
                    mBrand = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(1)) Then
                    mLaptopSerialNo = rs_source.Fields.Item(1)
                Else
                    mLaptopSerialNo = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(19)) Then
                    mcompname = rs_source.Fields.Item(19)
                Else
                    mcompname = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(20)) Then
                    mloginname = rs_source.Fields.Item(20)
                Else
                    mloginname = " "
                End If

         End If
        
                    If InStr(1, Trim(muser), "'") > 0 Then
                        muser = Mid(Trim(muser), 1, InStr(1, Trim(muser), "'") - 1) & _
                        Mid(Trim(muser), InStr(1, Trim(muser), "'") + 1, Len(Trim(muser)) - InStr(1, Trim(muser), "'"))
                    End If
        
                    If InStr(1, Trim(muser), "'") > 0 Then
                        muser = Mid(Trim(muser), 1, InStr(1, Trim(muser), "'") - 1) & _
                        Mid(Trim(muser), InStr(1, Trim(muser), "'") + 1, Len(Trim(muser)) - InStr(1, Trim(muser), "'"))
                    End If
        
        
'computer_name,user_name,asset_no,brand,description,cost_centre,serial_no
        If Trim(mcompname) <> "" Then
                sSql = "insert into and_csv_laptop(computer_name,user_name,asset_no,brand,description,cost_centre,serial_no,login_name) " & _
                        "values('" & Trim(mcompname) & "','" & muser & "','" & massetno & "','" & mBrand & "','" & _
                        mspecs & "','" & mcc & "','" & mLaptopSerialNo & "','" & Trim(mloginname) & "')"
                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
        End If
        
        mcompname = " "
        
        rs_source.MoveNext
        
        Loop
    End If

'delete blank computer name
sSql = "delete from and_csv_laptop where ltrim(computer_name) = ''"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

End Sub

Private Sub ConvertDesktopXls()

Dim sFileName As String

sFileName = "\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\SES Desktops.xls"

    'get date and time
    gDesktopDate = Format(FileDateTime(sFileName), "dd mmm yyyy")
    gDesktopTime = Format(FileDateTime(sFileName), "hh:mm")

mcompname = " "


Set adoConnection = New ADODB.Connection

Connectstring = "Provider=SQLOLEDB.1;Persist Security Info=False;" & _
   "User ID=scheme;Pwd=Er1c550n2;Initial Catalog=SES;Data Source=SESLSVRHO"

adoConnection.Open Connectstring

xCnXls = "Provider=MSDASQL.1;Extended Properties=DBQ=\\saudi-ericsson.com\Itinfo\cmdb\CSV Files\SES Desktops.xls;Driver={Microsoft Excel Driver (*.xls)};DriverId=790;MaxBufferSize=2048;PageTimeout=5;"

    Dim sourcetble As String
    
    'build query string for excel data
    sourcetble = " SELECT * FROM [Desktops$]"
    
Set rs_source = OpenRSXLS(sourcetble)
    If rs_source.RecordCount <> 0 Then
        Do While Not rs_source.EOF
            DoEvents

          If Not IsNull(rs_source.Fields.Item(0)) Then
                If Not IsNull(rs_source.Fields.Item(0)) Then
                    mcompname = rs_source.Fields.Item(0)
                Else
                    mcompname = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(1)) Then
                    muser = rs_source.Fields.Item(1)
                Else
                    muser = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(2)) Then
                    mspecs = rs_source.Fields.Item(2)
                Else
                    mspecs = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(3)) Then
                    mlocation = rs_source.Fields.Item(3)
                Else
                    mlocation = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(4)) Then
                    mcc = rs_source.Fields.Item(4)
                Else
                    mcc = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(5)) Then
                    massetno = rs_source.Fields.Item(5)
                Else
                    massetno = " "
                End If
                
                If Not IsNull(rs_source.Fields.Item(6)) Then
                    mLastUpdate = rs_source.Fields.Item(6)
                Else
                    mLastUpdate = " "
                End If

                If Not IsNull(rs_source.Fields.Item(7)) Then
                    mloginname = rs_source.Fields.Item(7)
                Else
                    mloginname = " "
                End If

         End If
        
        If Trim(mcompname) <> "" Then
            Add_Desk1
        End If
        
        mcompname = " "
        muser = " "
        mspecs = " "
        mlocation = " "
        mcc = " "
        mLastUpdate = " "
        massetno = " "
        'mremarks = " "
        
        rs_source.MoveNext
        
        Loop
    End If

'delete blank computer name
sSql = "delete from and_csv_desktop where ltrim(computer_name) = ''"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

End Sub


Private Sub ProcessDns_A()

sSql = "Select computer_name, dns_data from and_csv_dns where dns_type = 'Host (A)' and computer_name <> '(SAME AS PARENT FOLDER)'"
If DataAccess.GetRecordset(sConnectSQL, sSql, oRs) Then

    Do Until oRs.EOF
    
        mcompname = Trim(oRs!computer_name)
        mAddress = Trim(oRs!dns_data)

        sSql = "Select computer_name from and_csv_details where computer_name = '" & mcompname & _
                "' and (client_ipaddress = '" & mAddress & "' or client_ipaddress2 = '" & mAddress & _
                "' or client_ipaddress3 = '" & mAddress & "' or client_ipaddress4 = '" & mAddress & "')"
        If DataAccess.GetRecordset(sConnectSQL, sSql, oRs2) Then
            If oRs2.RecordCount > 0 Then
                sSql = "update and_csv_dns set ip_status = 'Ok' where computer_name = '" & mcompname & _
                "' and dns_data = '" & mAddress & "'"
                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
            End If
        End If
        oRs2.Close
        Set oRs2 = Nothing

        oRs.MoveNext
    Loop
    
End If
oRs.Close
Set oRs = Nothing

End Sub

Private Sub ProcessDns()

sSql = "Select computer_name, dns_data, reserve from and_csv_dns where dns_type = 'Host (A)' and computer_name <> '(SAME AS PARENT FOLDER)' " & _
        "and ip_status is null"

If DataAccess.GetRecordset(sConnectSQL, sSql, oRs) Then
    
    Do Until oRs.EOF
        If oRs!reserve <> "1" Then
            
            mcompname = Trim(oRs!computer_name)
            mAddress = Trim(oRs!dns_data)

            sSql = "Select computer_name from and_csv_details where computer_name = '" & mcompname & "'"
            If DataAccess.GetRecordset(sConnectSQL, sSql, oRs2) Then
                If oRs2.RecordCount > 0 Then
                    sSql = "update and_csv_details set invalid_ip = '" & mAddress & "', ip_status = 'Unregistered IP' where computer_name = '" & mcompname & "'"
                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                
                    sSql = "update and_csv_dns set ip_status = 'Unregistered IP', error_code = '1011' where computer_name = '" & mcompname & _
                        "' and dns_data = '" & mAddress & "'"
                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                
                Else
                    sSql = "update and_csv_dns set ip_status = 'Unregistered Device', error_code = '1101' where computer_name = '" & mcompname & _
                        "' and dns_data = '" & mAddress & "'"
                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                
                    sSql = "insert into and_csv_details(computer_name,ip_status,invalid_ip) " & _
                        "values('" & mcompname & "','Unregistered Device','" & mAddress & "')"
                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                End If
            End If
            oRs2.Close
            Set oRs2 = Nothing
        End If

        oRs.MoveNext
    Loop
End If
oRs.Close
Set oRs = Nothing

End Sub

Private Sub ProcessAntiV_A()

sSql = "Select computer_name, avipaddress from and_csv_av"
If DataAccess.GetRecordset(sConnectSQL, sSql, oRs) Then

    Do Until oRs.EOF
        mcompname = Trim(oRs!computer_name)
        mAddress = Trim(oRs!avipaddress)

        sSql = "Select computer_name from and_csv_details where computer_name = '" & mcompname & _
               "' and (client_ipaddress = '" & mAddress & "' or client_ipaddress2 = '" & mAddress & _
               "' or client_ipaddress3 = '" & mAddress & "' or client_ipaddress4 = '" & mAddress & "')"
       

        If DataAccess.GetRecordset(sConnectSQL, sSql, oRs2) Then
            If oRs2.RecordCount > 0 Then
                sSql = "update and_csv_av set ip_status = 'Ok' where computer_name = '" & mcompname & _
                "' and avipaddress = '" & mAddress & "'"
                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
            End If
        End If
        oRs2.Close
        Set oRs2 = Nothing

        oRs.MoveNext
    Loop
    
End If
oRs.Close
Set oRs = Nothing

End Sub

Private Sub ProcessAntiV_1()

Dim mAvStat As String

sSql = "Select computer_name, avserver, avdefinition, avlastscan, avstatus from and_csv_av"

If DataAccess.GetRecordset(sConnectSQL, sSql, oRs) Then
    
    Do Until oRs.EOF
        mcompname = Trim(oRs!computer_name)
        mAvStat = Trim(oRs!avstatus)

        If Trim(mAvStat) <> "" Then
            sSql = "update and_csv_details set avserver = '" & oRs!avserver & "', avdefinition = '" & oRs!avdefinition & _
                "', avlastscan = '" & oRs!avlastscan & "', ip_status = '" & oRs!avstatus & "'  where computer_name = '" & mcompname & "'"
            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
        Else
            sSql = "update and_csv_details set avserver = '" & oRs!avserver & "', avdefinition = '" & oRs!avdefinition & _
                "', avlastscan = '" & oRs!avlastscan & "', avstatus = '" & oRs!avstatus & "'  where computer_name = '" & mcompname & "'"
            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
        End If

        oRs.MoveNext
    Loop
End If
oRs.Close
Set oRs = Nothing

End Sub

Private Sub ProcessAntiV()

sSql = "Select computer_name, avipaddress, avserver, avdefinition, avlastscan, avstatus, reserve from and_csv_av where ip_status = ' '"

If DataAccess.GetRecordset(sConnectSQL, sSql, oRs) Then
    
    Do Until oRs.EOF
        If oRs!reserve <> "1" Then
            mcompname = Trim(oRs!computer_name)
            mAddress = Trim(oRs!avipaddress)

            sSql = "Select computer_name from and_csv_details where computer_name = '" & mcompname & "'"
            If DataAccess.GetRecordset(sConnectSQL, sSql, oRs2) Then
                If oRs2.RecordCount > 0 Then
                    sSql = "update and_csv_details set invalid_ip = '" & mAddress & _
                        "', ip_status = 'Unregistered IP' where computer_name = '" & mcompname & "'"
                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                
                    sSql = "update and_csv_av set ip_status = 'Unregistered IP', error_code = '1011' where computer_name = '" & mcompname & _
                        "' and avipaddress = '" & mAddress & "'"
                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                
                Else
                    sSql = "update and_csv_av set ip_status = 'Unregistered Device', error_code = '1101' where computer_name = '" & mcompname & _
                        "' and avipaddress = '" & mAddress & "'"
                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                
                    sSql = "insert into and_csv_details(computer_name,ip_status,invalid_ip,avserver,avdefinition,avlastscan,avstatus) " & _
                        "values('" & mcompname & "','Unregistered Device','" & mAddress & "','" & _
                        oRs!avserver & "','" & oRs!avdefinition & "','" & oRs!avlastscan & "','" & oRs!avstatus & "')"
                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                End If
            End If
            oRs2.Close
            Set oRs2 = Nothing
        End If
        oRs.MoveNext
    Loop
End If
oRs.Close
Set oRs = Nothing

End Sub

Private Sub ProcessAntiV2()

sSql = "Select computer_name, avipaddress, avserver, avdefinition, avlastscan, avstatus from and_csv_av where ip_status = 'Invalid Domain'"

If DataAccess.GetRecordset(sConnectSQL, sSql, oRs) Then
    
    Do Until oRs.EOF
        mcompname = Trim(oRs!computer_name)
        mAddress = Trim(oRs!avipaddress)

        sSql = "Select computer_name from and_csv_details where computer_name = '" & mcompname & _
                "'"
        If DataAccess.GetRecordset(sConnectSQL, sSql, oRs2) Then
            If oRs2.RecordCount = 0 Then
                sSql = "insert into and_csv_details(computer_name,ip_status,invalid_ip,avserver,avdefinition,avlastscan,avstatus) " & _
                        "values('" & mcompname & "','Unregistered Device','" & mAddress & "','" & _
                        oRs!avserver & "','" & oRs!avdefinition & "','" & oRs!avlastscan & "','" & oRs!avstatus & "')"
                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                
                sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
                        "values('" & mLogDate & "','" & mLogTime & "','av','" & mcompname & "','1101','Unregistered Device')"
                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
            End If
        End If
        oRs2.Close
        Set oRs2 = Nothing

        oRs.MoveNext
    Loop
End If
oRs.Close
Set oRs = Nothing

End Sub

Private Sub CmdUpdateNull_Click()

sSql = "update and_csv_consolidated set type = '' where type is null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_consolidated set client_ipaddress1 = '' where client_ipaddress1 is null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_consolidated set client_ipaddress2 = '' where client_ipaddress2 is null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_consolidated set client_ipaddress3 = '' where client_ipaddress3 is null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_consolidated set file_source = '' where file_source is null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_consolidated set desktop_laptop_user = '' where desktop_laptop_user is null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_consolidated set unique_id1 = '' where unique_id1 is null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_consolidated set unique_id2 = '' where unique_id2 is null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_consolidated set unique_id3 = '' where unique_id3 is null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_consolidated set sv_version = '' where sv_version is null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_consolidated set desktop_laptop_notconnected ='' where desktop_laptop_notconnected is null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_consolidated set updates_needed = '0' where updates_needed is null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_consolidated set updates_with_nostatus = '0' where updates_with_nostatus is null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_consolidated set prev_updates_needed = '0' where prev_updates_needed is null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)


'update and_csv_consolidated
sSql = "update and_csv_consolidated set updates_needed = [updates_needed]+[pending_reboot]"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)


CmdUpdateNull.Enabled = False

End Sub

Private Sub UpdatePrevAVDate()

Dim mcurrupdate As String

sSql = "SELECT computer_name, update_with_error, updates_needed, curr_msupdate FROM and_csv_msupdate_prev"

If DataAccess.GetRecordset(sConnectSQL, sSql, oRs) Then

    Do Until oRs.EOF
        mcompname = Trim(oRs!computer_name)
        mcurrupdate = Format(oRs!curr_msupdate, "dd mmm yyyy")

        sSql = "update and_csv_consolidated set prev_msupdate = '" & mcurrupdate & _
                    "', prev_update_with_error = '" & Trim(oRs!update_with_error) & _
                    "', prev_updates_needed = '" & Trim(oRs!updates_needed) & "' where computer_name = '" & mcompname & "'"
        bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
        

        oRs.MoveNext
    Loop
    
End If
oRs.Close
Set oRs = Nothing

End Sub

Private Sub Form_Load()

Rami


GetServerDateTime

gUpdateWinUpdate = 0

End Sub

Private Sub GetServerDateTime()

sSql = "Select getdate() as logdate from Ericsson.scheme.and_hd_request_hardware_user where userid = 'ALVIN.DELEON'"
If DataAccess.GetRecordset(sConnectSQL, sSql, oRs3) Then
    If oRs3.RecordCount > 0 Then
        gLogDateTime = oRs3!logdate
        mLogDate = Format(gLogDateTime, "dd mmm yyyy")
        mLogTime = Format(gLogDateTime, "hh:mm")
    End If
End If
oRs3.Close
Set oRs3 = Nothing

End Sub

Private Sub ProcessReserve()

    sSql = "Select computer_name from and_csv_dhcp where dhcp_description like 'Reserve%'"
    If DataAccess.GetRecordset(sConnectSQL, sSql, oRs) Then
        Do Until oRs.EOF
            mcompname = Trim(oRs!computer_name)
            
            sSql = "update and_csv_dcadcomputer set reserve = '1' where computer_name = '" & mcompname & "'"
            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
        
            sSql = "update and_csv_dhcp set reserve = '1' where computer_name = '" & mcompname & "'"
            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
            
            sSql = "update and_csv_dns set reserve = '1' where computer_name = '" & mcompname & "'"
            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
            
            sSql = "update and_csv_av set reserve = '1' where computer_name = '" & mcompname & "'"
            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
            
            oRs.MoveNext
        Loop
    End If
    oRs.Close
    Set oRs = Nothing

End Sub

Private Sub ProcessMain()

Dim mcounter As Integer
Dim xreserve As String

sSql = "Select computer_name from and_csv_dcadcomputer order by computer_name"
mcounter = 0
If DataAccess.GetRecordset(sConnectSQL, sSql, oRs) Then
    
    Do Until oRs.EOF
        mcompname = Trim(oRs!computer_name)
        
        
        If Trim(mcompname) <> "" Then
        
            sSql = "Select client_ipaddress, computer_name, dhcp_description, ip_status, substring(unique_id,1,15) as macadd from and_csv_dhcp " & _
                    "where computer_name = '" & Trim(mcompname) & "'"
            If DataAccess.GetRecordset(sConnectSQL, sSql, oRs2) Then
                    Do Until oRs2.EOF
                   
                        mcounter = mcounter + 1
                    
                        mAddress = Trim(oRs2!client_ipaddress)
                        mdhcpdesc = oRs2!dhcp_description
                        mUniqueId = oRs2!macadd
                        mIpStatus = oRs2!ip_status
                        
                        If Mid(mdhcpdesc, 1, 7) = "Reserve" Then
                            xreserve = "Ok"
                        End If

                        If mcounter > 1 Then
'                            sSql = "update and_csv_details set invalid_ip = '" & mAddress & _
'                                    "' where computer_name = '" & Trim(mcompname) & "'"
'                            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            
                            If mcounter = 2 Then
'                                sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
'                                     "values('" & mLogDate & "','" & mLogTime & "','dhcp','" & mcompname & "','1003','Duplicate DHCP Reservation')"
'                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                
                                If xreserve = "Ok" Then
                                    sSql = "update and_csv_details set client_ipaddress = '" & mAddress & _
                                        "', dhcp_desc = '" & mdhcpdesc & "', mac_address = '" & mUniqueId & _
                                        "' where computer_name = '" & Trim(mcompname) & "'"
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                End If
                                
                                sSql = "update and_csv_details set client_ipaddress2 = '" & mAddress & _
                                        "' where computer_name = '" & Trim(mcompname) & "'"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                                
                            End If
                            
                            If mcounter = 3 Then
                                sSql = "update and_csv_details set client_ipaddress3 = '" & mAddress & _
                                        "' where computer_name = '" & Trim(mcompname) & "'"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            End If
                            
                            If mcounter = 4 Then
                                sSql = "update and_csv_details set client_ipaddress4 = '" & mAddress & _
                                        "' where computer_name = '" & Trim(mcompname) & "'"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            End If
                            
                        Else
                            
                            If Mid(mdhcpdesc, 1, 7) <> "Reserve" Then
                                sSql = "update and_csv_details set client_ipaddress = '" & mAddress & _
                                    "', dhcp_desc = '" & mdhcpdesc & "', mac_address = '" & mUniqueId & _
                                    "', ip_status = '" & mIpStatus & "' where computer_name = '" & Trim(mcompname) & "'"
                                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            End If
                        End If

                                   
                        oRs2.MoveNext
                    Loop
            End If
            oRs2.Close
            Set oRs2 = Nothing
            mcounter = 0
        
        End If

        xreserve = " "
        oRs.MoveNext
    Loop
End If
oRs.Close
Set oRs = Nothing

End Sub

Private Sub ProcessDhcpUnregistered()

Dim mreserved As String

sSql = "Select client_ipaddress, computer_name, dhcp_description, substring(unique_id,1,15) as mac_address, ip_status, " & _
        "client_ipaddress, reserve from and_csv_dhcp where error_code = '1101' order by computer_name"
If DataAccess.GetRecordset(sConnectSQL, sSql, oRs) Then
    Do Until oRs.EOF
                
            mcompname = Trim(oRs!computer_name)
            mreserved = oRs!reserve
                            
        If mreserved <> "1" Then
            sSql = "Select computer_name from and_csv_details where computer_name = '" & mcompname & "'"
            If DataAccess.GetRecordset(sConnectSQL, sSql, oRs2) Then
                If oRs2.RecordCount > 0 Then
                    sSql = "update and_csv_details set client_ipaddress = '" & oRs!client_ipaddress & _
                    "', dhcp_desc = '" & oRs!dhcp_description & "', mac_address = '" & oRs!mac_address & _
                    "', ip_status = 'Unregistered Device', invalid_ip = ' ' where computer_name = '" & Trim(oRs!computer_name) & "'"
                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                Else
                    sSql = "insert into and_csv_details(client_ipaddress,computer_name,ip_status,invalid_ip,dhcp_desc,mac_address) " & _
                        "values('" & oRs!client_ipaddress & "','" & mcompname & "','Unregistered Device',' ','" & _
                        oRs!dhcp_description & "','" & oRs!mac_address & "')"
                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
            
                End If
            End If
            oRs2.Close
            Set oRs2 = Nothing
        End If

        oRs.MoveNext
    Loop
End If
oRs.Close
Set oRs = Nothing

End Sub

Private Sub ProcessLaptops()
Dim musername As String

sSql = "Select computer_name, user_name from and_csv_laptop where computer_name <> ' '"
If DataAccess.GetRecordset(sConnectSQL, sSql, oRs) Then
    Do Until oRs.EOF
        mcompname = Trim(oRs!computer_name)
        musername = Trim(oRs!user_name)
                            
        sSql = "Select computer_name from and_csv_details where computer_name = '" & mcompname & "'"
        If DataAccess.GetRecordset(sConnectSQL, sSql, oRs2) Then
            If oRs2.RecordCount > 0 Then
                sSql = "update and_csv_details set laptop_tag = '1' where computer_name = '" & _
                        Trim(mcompname) & "'"
                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                
                sSql = "update and_csv_details set dhcp_desc = '" & musername & _
                       "' where computer_name = '" & Trim(mcompname) & "' and (dhcp_desc = '' or dhcp_desc is null)"
                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
            Else
                sSql = "insert into and_csv_details(computer_name,dhcp_desc,ip_status,laptop_tag,log_tag) " & _
                        "values('" & mcompname & "','" & musername & "','No Network Connection','2','0')"
                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                
                sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
                        "values('" & mLogDate & "','" & mLogTime & "','av','" & mcompname & "','1102','No Network Connection')"
                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                
            End If
        End If
        oRs2.Close
        Set oRs2 = Nothing

        oRs.MoveNext
    Loop
End If
oRs.Close
Set oRs = Nothing

End Sub

Private Sub ProcessPrinters()

Dim musername As String

sSql = "Select computer_name, printer_name from and_csv_printer where computer_name <> ' '"
If DataAccess.GetRecordset(sConnectSQL, sSql, oRs) Then
    Do Until oRs.EOF
        mcompname = Trim(oRs!computer_name)
        musername = Trim(oRs!printer_name)
                            
        sSql = "Select computer_name from and_csv_details where computer_name = '" & mcompname & "'"
        If DataAccess.GetRecordset(sConnectSQL, sSql, oRs2) Then
            If oRs2.RecordCount > 0 Then
                sSql = "update and_csv_details set laptop_tag = '6' where computer_name = '" & _
                        Trim(mcompname) & "'"
                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                
                sSql = "update and_csv_details set dhcp_desc = '" & musername & _
                       "' where computer_name = '" & Trim(mcompname) & "' and (dhcp_desc = '' or dhcp_desc is null)"
                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
            Else
                sSql = "insert into and_csv_details(computer_name,dhcp_desc,ip_status,laptop_tag,log_tag) " & _
                        "values('" & mcompname & "','" & musername & "','No Network Connection','6','0')"
                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                
                sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
                        "values('" & mLogDate & "','" & mLogTime & "','printer','" & mcompname & "','1102','No Network Connection')"
                bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                
            End If
        End If
        oRs2.Close
        Set oRs2 = Nothing

        oRs.MoveNext
    Loop
End If
oRs.Close
Set oRs = Nothing

End Sub

Private Sub ProcessInactive()

Dim mreserved As String

sSql = "Select computer_name, reserve from and_csv_dhcp where upper(lease_expiration) like '%INACTIVE%'"
If DataAccess.GetRecordset(sConnectSQL, sSql, oRs) Then
    Do Until oRs.EOF

            mcompname = Trim(oRs!computer_name)
            mreserved = oRs!reserve
                            
        If mreserved <> "1" Then
            sSql = "update and_csv_details set ip_status = 'Inactive' where computer_name = '" & Trim(mcompname) & "'"
            bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
        End If


        oRs.MoveNext
    Loop
End If
oRs.Close
Set oRs = Nothing

End Sub

Private Sub ProcessLogTag()

sSql = "update and_csv_details set log_tag = '1' where computer_name in(Select computer_name from and_csv_error)"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

sSql = "update and_csv_details set log_tag = '0' where log_tag is null"
bExec = DataAccess.ExecQuery(sConnectSQL, sSql)

End Sub

Private Sub ProcessScanLog()

sSql = "Select ip_address from and_csv_scanlog"
If DataAccess.GetRecordset(sConnectSQL, sSql, oRs) Then
    Do Until oRs.EOF
        mAddress = Trim(oRs!ip_address)
        
        sSql = "Select client_ipaddress from and_csv_dhcp where client_ipaddress = '" & mAddress & "'"
        If DataAccess.GetRecordset(sConnectSQL, sSql, oRs2) Then
            If oRs2.RecordCount = 0 Then
                sSql = "Select dns_data from and_csv_dns where dns_data = '" & mAddress & "'"
                If DataAccess.GetRecordset(sConnectSQL, sSql, oRs3) Then
                    If oRs3.RecordCount = 0 Then
                        
                        sSql = "Select avipaddress from and_csv_av where avipaddress = '" & mAddress & "'"
                        If DataAccess.GetRecordset(sConnectSQL, sSql, oRs4) Then
                            If oRs4.RecordCount = 0 Then
                                sSql = "insert into and_csv_error(log_date,log_time,log_source,computer_name,log_error,log_description) " & _
                                    "values('" & mLogDate & "','" & mLogTime & "','ipscan','" & mAddress & "','1012','Illegal IP Address')"
                                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                            End If
                        End If
                        oRs4.Close
                        Set oRs4 = Nothing
                        
                    End If
                End If
                oRs3.Close
                Set oRs3 = Nothing
            
            End If
        End If
        oRs2.Close
        Set oRs2 = Nothing

        oRs.MoveNext
    Loop
End If
oRs.Close
Set oRs = Nothing

End Sub

Private Sub Rami()

Dim mdata As String
Dim mdata2 As String
Dim mdata3 As String
Dim mdata4 As String
Dim mdata5 As String
Dim mdata6 As String
Dim mdata7 As String
Dim mdata8 As String
Dim mdata9 As String
Dim mdata10 As String

    sSourceFile = "d:\outlookusers.csv"
        
    Open sSourceFile For Input As #1 ' Open file.
    
    i = 0
    
    
    Do While Not EOF(1) ' Loop until End of file.
        Input #1, MyString ' Read data into one variable.



            i = i + 1
            
            For X = 1 To Len(MyString)
                Oneletter = Mid(MyString, X, 1)

                DoEvents
                Newstring = Newstring & Oneletter
        
            Next X
                    
            If MyString = "" Then
                Newstring = " "
            End If
            
            Select Case i
                Case 1
                    mdata = Newstring
                Case 2
                    
                    
                    mdata2 = Newstring
                    
                Case 3
                    mdata3 = Newstring
                
                Case 4
                    mdata4 = Newstring
                Case 5
                    mdata5 = Newstring
                Case 6
                    mdata6 = Newstring
                Case 7
                    mdata7 = Newstring
                    
                Case 8
                    mdata8 = Newstring
                Case 9
                    mdata9 = Newstring
                   
                   i = 0
                   
                    If InStr(1, Trim(mdata7), "\") > 0 Then
                        mdata10 = Mid(Trim(mdata7), InStr(1, Trim(mdata7), "\") + 1, Len(Trim(mdata7)) - InStr(1, Trim(mdata7), "\"))
                    End If
                   
                    'append to and_csv_dcadcomputer
                    sSql = "insert into zrami1(Data1,Data2,Data3,Data4,Data5,Data6,Data7,Data8,Data9,Data10) " & _
                        "values('" & mdata & "','" & mdata2 & "','" & mdata3 & "','" & mdata4 & "','" & mdata5 & "','" & _
                        mdata6 & "','" & mdata7 & "','" & mdata8 & "','" & mdata9 & "','" & mdata10 & "')"
                    bExec = DataAccess.ExecQuery(sConnectSQL, sSql)
                    
            End Select
            
            Newstring = ""
                                
        'Newstring = ""
        'i = 0

        DoEvents ' it is important To unlock the screen
        
Loop
Close #1 ' Close file.

End Sub
